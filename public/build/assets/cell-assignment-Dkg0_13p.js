import{j as e,r,K as I,S as O,L as V}from"./app-bV5rmUq0.js";import{D as z}from"./data-table-Dwm5w5Le.js";import{B as p}from"./button-FpHCtBEj.js";import{C as B,a as H,b as q,c as R}from"./card-ddPS0xap.js";import{I as G}from"./input-HNXWlf2F.js";import{L as v}from"./label-1hTpFXtw.js";import{S as D,a as S,b as N,c as _,d as g}from"./select-DJi5e7jS.js";import{D as U,e as J,a as Q,b as W,c as X,d as Y,A as Z}from"./app-layout-BOEMzn-o.js";import{D as ee,a as se,E as le,b as te,c as ne,d as F}from"./dropdown-menu-BZ7h3m1l.js";import{C as ae}from"./checkbox-BXy9sEkQ.js";import{A as T,b as k,a as M}from"./alert-B0JrO9qt.js";import"./table-OVJCMi64.js";import"./index-Dx3vTjSQ.js";import"./index-CIpshv6h.js";import"./users-BJq_umgB.js";import"./user-CnlA_BFo.js";import"./scale-DyS0YXTY.js";import"./eye-DrwJXlWy.js";import"./index-BfIu_LWJ.js";const re=[{accessorKey:"assignment_id",header:"Assignment ID"},{accessorKey:"cell_number",header:"Cell Number"},{accessorKey:"cell_id",header:"Cell ID"},{accessorKey:"pdl_id",header:"PDL ID"},{accessorKey:"pdl_name",header:"PDL Name"},{accessorKey:"assigned_date",header:"Assigned Date",cell:({row:a})=>new Date(a.original.assigned_date).toLocaleDateString()},{id:"actions",header:"Actions",cell:({row:a})=>{const h=a.original;return e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(p,{variant:"ghost",size:"icon",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(le,{className:"h-4 w-4"})]})}),e.jsxs(te,{align:"end",children:[e.jsx(ne,{children:"Actions"}),e.jsx(F,{onClick:()=>console.log("Edit assignment",h.assignment_id),children:"Edit"}),e.jsx(F,{onClick:()=>console.log("Delete assignment",h.assignment_id),children:"Delete"})]})]})}}];function ie({cells:a,pdls:h}){const[y,f]=r.useState(!1),[n,i]=r.useState(""),[o,c]=r.useState([]),[m,C]=r.useState(""),[x,b]=r.useState("all"),u=r.useMemo(()=>{let s=h;if(m&&(s=s.filter(l=>`${l.fname} ${l.lname}`.toLowerCase().includes(m.toLowerCase())||l.id.toString().includes(m))),n){const l=a.find(d=>d.cell_id.toString()===n);l&&(s=s.filter(d=>{var P;return((P=d.gender)==null?void 0:P.toLowerCase())===l.gender}))}return s},[h,m,n,a]),t=r.useMemo(()=>{let s=a;return x!=="all"&&(s=s.filter(l=>l.gender===x)),s},[a,x]),j=s=>{i(s),c([])},E=()=>{!n||o.length===0||O.post(route("cell-assignments.store"),{cell_id:n,pdl_ids:o},{onSuccess:()=>{f(!1),i(""),c([]),C(""),b("all")}})},K=s=>{c(l=>l.includes(s)?l.filter(d=>d!==s):[...l,s])},$=()=>{const s=u.map(l=>l.id);c(l=>s.every(d=>l.includes(d))?l.filter(d=>!s.includes(d)):[...new Set([...l,...s])])},{props:L}=I(),w=L.success,A=L.errors||{};return e.jsxs(U,{open:y,onOpenChange:f,children:[e.jsx(J,{asChild:!0,children:e.jsx(p,{children:"Assign PDL to Cell"})}),e.jsxs(Q,{className:"max-h-[80vh] max-w-3xl overflow-y-auto",children:[e.jsxs(W,{children:[e.jsx(X,{children:"Assign PDLs to Cell"}),e.jsx(Y,{children:"Select a cell and choose PDLs to assign to it."})]}),Object.keys(A).length>0&&e.jsx("div",{"data-alert-container":!0,className:"relative",children:e.jsxs(T,{variant:"destructive",children:[e.jsx("button",{type:"button","aria-label":"Close",onClick:s=>{const l=s.currentTarget.closest("[data-alert-container]")||void 0;l&&(l.style.display="none")},className:"absolute top-2 right-2 rounded p-1 text-lg leading-none hover:bg-muted",children:"×"}),e.jsx(k,{children:"Unable to process request"}),e.jsx(M,{children:e.jsx("ul",{className:"list-inside list-disc space-y-1",children:Object.values(A).map((s,l)=>e.jsx("li",{className:"text-sm",children:s},l))})})]})}),w&&e.jsx("div",{"data-alert-container":!0,className:"relative",ref:s=>{if(!s)return;s.style.display="";const l=s;l._timer&&clearTimeout(l._timer),l._timer=setTimeout(()=>{s.style.display="none"},3e3)},children:e.jsxs(T,{children:[e.jsx("button",{type:"button","aria-label":"Close",onClick:s=>{const l=s.currentTarget.closest("[data-alert-container]")||void 0;l&&(l.style.display="none")},className:"absolute top-2 right-2 rounded p-1 text-sm leading-none hover:bg-muted",children:"×"}),e.jsx(k,{children:"Success"}),e.jsx(M,{children:w})]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(v,{htmlFor:"gender-filter",children:"Filter by Gender"}),e.jsxs(D,{value:x,onValueChange:b,children:[e.jsx(S,{children:e.jsx(N,{placeholder:"Select gender filter"})}),e.jsxs(_,{children:[e.jsx(g,{value:"all",children:"All Genders"}),e.jsx(g,{value:"male",children:"Male Only"}),e.jsx(g,{value:"female",children:"Female Only"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(v,{htmlFor:"cell",children:"Select Cell"}),e.jsxs(D,{value:n,onValueChange:j,children:[e.jsx(S,{children:e.jsx(N,{placeholder:"Choose a cell"})}),e.jsx(_,{children:t.map(s=>e.jsxs(g,{value:s.cell_id.toString(),children:[s.cell_name," (Capacity: ",s.capacity,", Gender: ",s.gender,")"]},s.cell_id))})]})]}),n&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{htmlFor:"pdl-search",children:"Select PDLs"}),e.jsx(p,{variant:"outline",size:"sm",onClick:$,disabled:u.length===0,children:"Toggle All Filtered"})]}),e.jsx(G,{id:"pdl-search",placeholder:"Search PDLs by name or ID",value:m,onChange:s=>C(s.target.value)}),n&&e.jsxs("div",{className:"text-sm text-gray-600 bg-blue-50 p-2 rounded",children:[e.jsx("strong",{children:"Note:"})," Only PDLs matching the selected cell's gender are shown.",(()=>{const s=a.find(l=>l.cell_id.toString()===n);return s?` Showing ${s.gender} PDLs only.`:""})()]}),e.jsx("div",{className:"max-h-60 overflow-y-auto rounded-md border p-2",children:u.length>0?u.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-gray-50",children:[e.jsx(ae,{id:`pdl-${s.id}`,checked:o.includes(s.id),onCheckedChange:()=>K(s.id)}),e.jsxs("label",{htmlFor:`pdl-${s.id}`,className:"text-sm leading-none font-medium peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:[s.fname," ",s.lname," (ID: ",s.id,")"]})]},s.id)):e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:n?"No PDLs available for the selected cell gender.":m?"No PDLs match your search":"No PDLs available"})}),o.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Selected: ",o.length," PDL(s)"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(p,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(p,{onClick:E,disabled:!n||o.length===0,children:"Assign Selected"})]})]})]})}function we(){const{props:a}=I(),{assignments:h,cells:y,pdls:f,filters:n}=a,[i,o]=r.useState(n.search||""),[c,m]=r.useState("all"),C=h.map(t=>({assignment_id:t.assignment_id,cell_number:t.cell.cell_name,cell_id:t.cell.cell_id,cell_gender:t.cell.gender,pdl_id:t.pdl.id,pdl_name:`${t.pdl.fname} ${t.pdl.lname}`,pdl_gender:t.pdl.gender,assigned_date:t.created_at})),x=r.useMemo(()=>{let t=C;return i&&(t=t.filter(j=>j.cell_number.toLowerCase().includes(i.toLowerCase())||j.pdl_name.toLowerCase().includes(i.toLowerCase()))),c!=="all"&&(t=t.filter(j=>j.cell_gender===c)),t},[C,i,c]),b=()=>{O.get("/admin/pdl-management/cell-assignment",{search:i})},u=[{title:"Cell Management",href:"/cell-management"},{title:"Assignments",href:"/admin/pdl-management/cell-assignment"}];return e.jsxs(Z,{breadcrumbs:u,children:[e.jsx(V,{title:"Cell Assignment Management"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Cell Assignments"}),e.jsxs(B,{children:[e.jsx(H,{children:e.jsx(q,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Cell Assignment List"}),e.jsx(ie,{cells:y,pdls:f})]})})}),e.jsxs(R,{children:[e.jsxs("div",{className:"mb-4 flex items-center space-x-4",children:[e.jsx(v,{htmlFor:"search",className:"text-sm font-medium",children:"Search Assignments"}),e.jsx(G,{id:"search",placeholder:"Search by cell number or PDL name",className:"w-64",value:i,onChange:t=>o(t.target.value),onKeyDown:t=>t.key==="Enter"&&b()}),e.jsx(p,{variant:"outline",onClick:b,children:"Search"})]}),e.jsxs("div",{className:"mb-4 flex items-center space-x-4",children:[e.jsx(v,{htmlFor:"gender-filter",className:"text-sm font-medium",children:"Filter by Gender"}),e.jsxs(D,{value:c,onValueChange:m,children:[e.jsx(S,{className:"w-48",children:e.jsx(N,{placeholder:"Select gender filter"})}),e.jsxs(_,{children:[e.jsx(g,{value:"all",children:"All Genders"}),e.jsx(g,{value:"male",children:"Male Only"}),e.jsx(g,{value:"female",children:"Female Only"})]})]})]}),e.jsx(z,{columns:re,data:x})]})]})]})]})}export{we as default};
