import{K as q,r as A,m as K,j as e,L as P}from"./app-BPxrKEyb.js";import{C as te,a as de,b as ie,c as ce}from"./card-MY-iCpFz.js";import{T as Y,a as J,b as k,c as l,d as Q,e as t}from"./table-Da5D_Wo2.js";import{A as F,b as G,a as B}from"./alert-Dy7BgFLC.js";import{B as c}from"./button-CEMgu7CE.js";import{D,i as W,a as C,b as S,c as M,d as _,g as R,h as X,A as oe}from"./app-layout-B7fNkZnx.js";import{I as Z}from"./input-CvRLkRAD.js";import{L as u}from"./label-BHAojcQv.js";import{S as E,a as L,b as O,c as I,d as m}from"./select-Dq-Ok0hR.js";import{T as ee}from"./textarea-C2McMECy.js";import{B as z}from"./badge-CwiTgdPp.js";import{E as me}from"./eye-DJMTalI9.js";import{C as H}from"./scale-CeClP0FS.js";import{U as xe}from"./user-DBhr3jVO.js";import{S as he}from"./square-pen-DGkOkH8-.js";import{T as je}from"./trash-2-DdlCIawV.js";import{T as ue}from"./triangle-alert-0TgY3ZRZ.js";import{f as N}from"./format-B3rlCQGj.js";import{C as pe}from"./custody-management-DKudcUTW.js";import{g as ge}from"./dateUtils-Iw3XMDmk.js";import"./index-Bwm_JLZs.js";import"./users-HviPfwPA.js";import"./circle-alert-BcedVOno.js";import"./index-D55dR1IO.js";import"./index-xw3hog76.js";import"./index-B8miVs9F.js";import"./index-DXqzBNPn.js";function ye({pdl:s,records:x}){const{props:r}=q(),h=r.success,[w,p]=A.useState(null),[y,i]=A.useState(!1),[d,f]=A.useState(null),[T,j]=A.useState(!1),{data:b,setData:g,put:U,delete:n,processing:o,errors:v,reset:V}=K({type:"gcta",days:0,reason:""}),se=a=>{p(a),g({type:a.type,days:a.days,reason:a.reason}),i(!0)},ae=a=>{a.preventDefault(),w&&U(route("admin.time-allowance.update-record",w.id),{preserveScroll:!0,onSuccess:()=>{V(),i(!1),p(null)}})},re=a=>{f(a),j(!0)},ne=()=>{d&&n(route("admin.time-allowance.revoke",d.id),{preserveScroll:!0,onSuccess:()=>{j(!1),f(null)}})},$=a=>a==="gcta"?e.jsx(z,{className:"bg-blue-100 text-blue-800",children:"GCTA"}):e.jsx(z,{className:"bg-green-100 text-green-800",children:"TASTM"});return e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx(P,{title:"Time Allowance Records"}),e.jsx(W,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"View Records"]})}),e.jsxs(C,{className:"max-h-[80vh] overflow-y-auto sm:max-w-[800px]",children:[e.jsxs(S,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Time Allowance Records for ",s.fname," ",s.lname]}),e.jsx(_,{children:"View and manage all time allowance records for this PDL."})]}),h&&e.jsxs(F,{variant:"default",className:"mb-4 border-green-200 bg-green-50 text-green-800",children:[e.jsx(G,{children:"Success"}),e.jsx(B,{children:h})]}),x.length>0?e.jsx("div",{className:"space-y-4",children:e.jsxs(Y,{children:[e.jsx(J,{children:e.jsxs(k,{children:[e.jsx(l,{children:"Type"}),e.jsx(l,{children:"Days"}),e.jsx(l,{children:"Reason"}),e.jsx(l,{children:"Awarded By"}),e.jsx(l,{children:"Date"}),e.jsx(l,{className:"text-right",children:"Actions"})]})}),e.jsx(Q,{children:x.map(a=>e.jsxs(k,{children:[e.jsx(t,{children:$(a.type)}),e.jsxs(t,{className:"font-medium",children:[a.days," days"]}),e.jsx(t,{className:"max-w-xs truncate",children:a.reason}),e.jsx(t,{children:a.awardedBy?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm",children:[a.awardedBy.fname," ",a.awardedBy.lname]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Unknown"})}),e.jsx(t,{children:N(new Date(a.awarded_at),"MMM dd, yyyy")}),e.jsx(t,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>se(a),className:"h-8 w-8 p-0",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>re(a),className:"h-8 w-8 p-0 text-red-600 hover:bg-red-50 hover:text-red-700",children:e.jsx(je,{className:"h-4 w-4"})})]})})]},a.id))})]})}):e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx(H,{className:"mx-auto mb-4 h-12 w-12 text-gray-300"}),e.jsx("p",{children:"No time allowance records found for this PDL."})]}),e.jsx(R,{children:e.jsx(X,{asChild:!0,children:e.jsx(c,{variant:"secondary",children:"Close"})})})]})]}),e.jsx(D,{open:y,onOpenChange:i,children:e.jsx(C,{className:"sm:max-w-[500px]",children:e.jsxs("form",{id:"edit-time-allowance-form",onSubmit:ae,children:[e.jsxs(S,{children:[e.jsx(M,{children:"Edit Time Allowance Record"}),e.jsx(_,{children:"Update the details for this time allowance record."})]}),Object.keys(v).length>0&&e.jsxs(F,{variant:"destructive",className:"mt-4 mb-4",children:[e.jsx(G,{children:"Unable to process request"}),e.jsx(B,{children:Object.values(v).map((a,le)=>e.jsx("ul",{className:"list-inside list-disc text-sm",children:e.jsx("li",{children:String(a)})},le))})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"edit-type",children:"Allowance Type"}),e.jsxs(E,{value:b.type,onValueChange:a=>g("type",a),required:!0,children:[e.jsx(L,{children:e.jsx(O,{placeholder:"Select allowance type"})}),e.jsxs(I,{children:[e.jsx(m,{value:"gcta",children:"Good Conduct Time Allowance (GCTA)"}),e.jsx(m,{value:"tastm",children:"Time Allowance for Study, Teaching & Mentoring (TASTM)"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"edit-days",children:"Days"}),e.jsx(Z,{id:"edit-days",name:"days",type:"number",min:"0",value:b.days,onChange:a=>g("days",parseInt(a.target.value)||0),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"edit-reason",children:"Reason"}),e.jsx(ee,{id:"edit-reason",name:"reason",value:b.reason,onChange:a=>g("reason",a.target.value),placeholder:"Enter the reason for this time allowance",required:!0})]})]}),e.jsxs(R,{children:[e.jsx(c,{type:"button",variant:"secondary",onClick:()=>{i(!1),p(null),V()},children:"Cancel"}),e.jsx(c,{type:"submit",form:"edit-time-allowance-form",className:"bg-blue-500 hover:bg-blue-600",disabled:o,children:o?"Updating...":"Update Record"})]})]})})}),e.jsx(D,{open:T,onOpenChange:j,children:e.jsxs(C,{className:"sm:max-w-[400px]",children:[e.jsxs(S,{children:[e.jsxs(M,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(ue,{className:"h-5 w-5"}),"Confirm Deletion"]}),e.jsx(_,{children:"Are you sure you want to revoke this time allowance record? This action cannot be undone."})]}),d&&e.jsxs("div",{className:"rounded-md border bg-gray-50 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[$(d.type),e.jsxs("span",{className:"font-medium",children:[d.days," days"]})]}),e.jsxs("p",{className:"mb-1 text-sm text-gray-600",children:[e.jsx("strong",{children:"Reason:"})," ",d.reason]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Date:"})," ",N(new Date(d.awarded_at),"MMM dd, yyyy")]})]}),e.jsxs(R,{children:[e.jsx(c,{variant:"secondary",onClick:()=>{j(!1),f(null)},children:"Cancel"}),e.jsx(c,{variant:"destructive",onClick:ne,disabled:o,children:o?"Revoking...":"Revoke Record"})]})]})})]})}function fe({pdl:s,gctaDays:x,tastmDays:r,records:h}){const{props:w}=q(),p=w.success,y=()=>{const n=typeof(s==null?void 0:s.years_served)=="object"?s.years_served.years:(s==null?void 0:s.years_served)||0;return n>=0&&n<=2?20:n>=3&&n<=5?23:n>=6&&n<=10?25:n>=11?30:20},{data:i,setData:d,post:f,processing:T,errors:j,reset:b}=K({type:"gcta",days:y(),reason:"",supporting_documents:[]}),g=n=>{n.preventDefault(),f(route("admin.time-allowance.update",s.id),{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{b()}})},U=n=>{d("type",n),n==="gcta"?d("days",y()):d("days",15)};return e.jsxs(D,{children:[e.jsx(P,{title:"Manage Time Allowance"}),e.jsx(W,{asChild:!0,children:e.jsx(c,{variant:"outline",children:"Manage Allowance"})}),e.jsx(C,{className:"sm:max-w-[500px]",children:e.jsxs("form",{id:"time-allowance-form",onSubmit:g,children:[e.jsxs(S,{children:[e.jsxs(M,{children:["Manage Time Allowance for ",s.fname," ",s.lname]}),e.jsx(_,{children:"Add time allowance days for Good Conduct Time Allowance (GCTA) or Time Allowance for Study, Teaching and Mentoring (TASTM)."})]}),Object.keys(j).length>0&&e.jsxs(F,{variant:"destructive",className:"mt-4 mb-4",children:[e.jsx(G,{children:"Unable to process request"}),e.jsx(B,{children:Object.values(j).map((n,o)=>e.jsx("ul",{className:"list-inside list-disc text-sm",children:e.jsx("li",{children:n})},o))})]}),p&&e.jsxs(F,{variant:"default",className:"mb-4 border-green-200 bg-green-50 text-green-800",children:[e.jsx(G,{children:"Success"}),e.jsx(B,{children:p})]}),e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-4 py-2",children:[e.jsxs("div",{className:"rounded-md border border-blue-200 bg-blue-50 p-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Current GCTA Days"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:x})]}),e.jsxs("div",{className:"rounded-md border border-green-200 bg-green-50 p-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:"Current TASTM Days"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:r})]})]}),e.jsxs("div",{className:"mb-4 rounded-md border border-gray-200 bg-gray-50 p-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"Years Served"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:typeof(s==null?void 0:s.years_served)=="object"?s.years_served.formatted:`${(s==null?void 0:s.years_served)||0} years`}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"GCTA Default:"})," ",y()," days per month (based on"," ",typeof(s==null?void 0:s.years_served)=="object"?s.years_served.years:(s==null?void 0:s.years_served)||0," years served)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TASTM Default:"})," 15 days per month (fixed)"]})]})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"type",children:"Allowance Type"}),e.jsxs(E,{value:i.type,onValueChange:U,required:!0,children:[e.jsx(L,{children:e.jsx(O,{placeholder:"Select allowance type"})}),e.jsxs(I,{children:[e.jsx(m,{value:"gcta",children:"Good Conduct Time Allowance (GCTA)"}),e.jsx(m,{value:"tastm",children:"Time Allowance for Study, Teaching & Mentoring (TASTM)"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"days",children:"Days to Add"}),e.jsxs(E,{value:i.days.toString(),onValueChange:n=>d("days",parseInt(n)),required:!0,children:[e.jsx(L,{children:e.jsx(O,{placeholder:"Select days to add"})}),e.jsx(I,{children:i.type==="gcta"?e.jsxs(e.Fragment,{children:[e.jsx(m,{value:"20",children:"20 days (0-2 years served)"}),e.jsx(m,{value:"23",children:"23 days (3-5 years served)"}),e.jsx(m,{value:"25",children:"25 days (6-10 years served)"}),e.jsx(m,{value:"30",children:"30 days (11+ years served)"})]}):e.jsx(m,{value:"15",children:"15 days (TASTM fixed)"})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"reason",children:"Reason"}),e.jsx(ee,{id:"reason",name:"reason",value:i.reason,onChange:n=>d("reason",n.target.value),placeholder:"Enter the reason for adding time allowance",required:!0})]}),e.jsxs("div",{className:"grid gap-2 mb-2",children:[e.jsx(u,{htmlFor:"supporting_documents",children:"Supporting Documents (optional)"}),e.jsx("div",{children:e.jsx("div",{className:"mb-1 text-xs text-gray-600",children:"Upload supporting documents (e.g., approval letter, memorandum). You can select multiple files (JPG, PNG)."})}),e.jsxs("div",{children:[e.jsx(Z,{type:"file",id:"supporting_documents",name:"supporting_documents",accept:".jpg,.jpeg,.png",multiple:!0,onChange:n=>{const o=Array.from(n.target.files||[]);d("supporting_documents",o)}}),i.supporting_documents&&i.supporting_documents.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:i.supporting_documents.map((n,o)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("a",{href:URL.createObjectURL(n),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:n.name}),e.jsxs("span",{className:"text-gray-500",children:["(",(n.size/1024).toFixed(2)," KB)"]}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>{const v=[...i.supporting_documents];v.splice(o,1),d("supporting_documents",v)},children:"Remove"})]},o))})]})]})]}),e.jsx(R,{children:e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(X,{asChild:!0,children:e.jsx(c,{variant:"secondary",children:"Cancel"})}),e.jsx(ye,{pdl:s,records:h}),e.jsx(c,{type:"submit",form:"time-allowance-form",className:"bg-blue-500 hover:bg-blue-600",disabled:T,children:T?"Adding...":"Add Allowance"})]})})})]})})]})}const be=[{title:"PDL Management",href:"/pdl-management"}];function Ye(){const{props:s}=q(),{verifications:x}=s;return console.log("Verifications:",x),e.jsxs(oe,{breadcrumbs:be,children:[e.jsx(P,{title:"Personal Information"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Time Allowance Management"}),e.jsxs(te,{children:[e.jsx(de,{children:e.jsx(ie,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("span",{children:"Time Allowance List"})})})}),e.jsx(ce,{children:e.jsxs(Y,{children:[e.jsx(J,{children:e.jsxs(k,{children:[e.jsx(l,{children:"ID"}),e.jsx(l,{children:"Full Name"}),e.jsx(l,{children:"Alias"}),e.jsx(l,{children:"Gender"}),e.jsx(l,{children:"GCTA Days"}),e.jsx(l,{children:"TASTM Days"}),e.jsx(l,{children:"Admission Date"}),e.jsx(l,{children:"Release Date"}),e.jsx(l,{children:"Date of Birth"}),e.jsx(l,{children:"Age"}),e.jsx(l,{children:"Added By"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(Q,{children:x.map(r=>{var h;return r.pdl&&e.jsxs(k,{children:[e.jsx(t,{children:r.pdl.id}),e.jsx(t,{children:`${r.pdl.fname} ${r.pdl.lname}`}),e.jsx(t,{children:r.pdl.alias??"-"}),e.jsx(t,{children:r.pdl.gender??"-"}),e.jsx(t,{className:"font-medium",children:r.gcta_days}),e.jsx(t,{className:"font-medium",children:r.tastm_days}),e.jsx(t,{children:r.pdl.admission_date?N(new Date(r.pdl.admission_date),"MMM dd, yyyy"):"—"}),e.jsx(t,{children:r.pdl.release_date?N(new Date(r.pdl.release_date),"MMM dd, yyyy"):"—"}),e.jsx(t,{children:N(new Date(r.pdl.birthdate),"MMMM dd, yyyy")}),e.jsx(t,{children:ge(r.pdl.birthdate)}),e.jsx(t,{children:r.pdl.personnel?`${r.pdl.personnel.fname} ${r.pdl.personnel.lname}`:"—"}),e.jsxs(t,{className:"space-x-1 flex items-center gap-2",children:[e.jsx(fe,{pdl:r.pdl,gctaDays:r.gcta_days,tastmDays:r.tastm_days,records:((h=r.pdl)==null?void 0:h.time_allowance_records)||[]}),e.jsx(pe,{pdl:r.pdl})]})]},r.pdl.id)})})]})})]})]})]})}export{Ye as default};
