import{K as Le,r as u,m as Q,j as e,L as ke,$ as Ee}from"./app-BwBP25H8.js";import{A as I,b as M,a as B}from"./alert-Dl5gl7Te.js";import{B as i}from"./button-Ce5sTJI0.js";import{C as Te,a as Pe,b as Re,c as $e}from"./card-C7OCBjvW.js";import{A as Fe,D as W,a as X,b as Y,c as Z,d as ee,h as Ie}from"./app-layout-o3KJvi82.js";import{I as x}from"./input-BnF1_wQI.js";import{L as o}from"./label-uz79b_uR.js";import{S as se,a as re,b as ae,c as te,d as c,C as Me}from"./select-B--obqXo.js";import{T as Be,a as Ue,b as ue,c as h,d as Ve,e as m}from"./table-BCJXfVPN.js";import{T as xe}from"./textarea-17atU9IR.js";import{V as He}from"./view-pdl-information-CgDw_GQK.js";import{g as le}from"./dateUtils-Iw3XMDmk.js";import{S as ze}from"./users-BPzLc4qV.js";import{A as Ge}from"./archive-DA9Ml_8h.js";import{S as qe}from"./square-pen-DZnPaEpl.js";import{f as Je}from"./format-B3rlCQGj.js";import"./index-qOYF86Gd.js";import"./user-Kuo_8HIm.js";import"./scale-CD1twoLw.js";import"./eye-q10uODIs.js";import"./index-jb01HAXI.js";import"./index-Bbpa0way.js";import"./index-DJjklhAC.js";import"./index-BuaqV0xT.js";import"./accordion-COWLwr07.js";import"./badge-DoOGkZzG.js";import"./radio-group-DCWW622J.js";import"./plus-BxUPJelB.js";import"./custody-management-8KnqIbrk.js";const Ke=[{title:"PDL Management",href:"/pdl-management"}];function ys(){var he;const{props:U}=Le(),{verifications:V,flash:H}=U;console.log("Verifications:",V);const{auth:z,errors:l}=U,G=((he=z==null?void 0:z.user)==null?void 0:he.position)==="admin",[t,pe]=u.useState(null),[je,q]=u.useState(!1),[ve,J]=u.useState(!1),[ge,P]=u.useState(!1),[R,_e]=u.useState(""),[_,fe]=u.useState("name"),[D,ne]=u.useState("asc"),[j,f]=u.useState(1),[A,Ce]=u.useState(10),{data:ce,setData:K,post:Ne,processing:de}=Q({admission_date:"",release_date:""}),{data:C,setData:v,post:be,processing:ie}=Q({court_order_number:"",order_type:"",order_date:"",received_date:"",remarks:"",document_type:"",court_branch:""}),{data:p,setData:N,post:ye,processing:oe}=Q({archive_status:"",archive_reason:"",archive_court_order_type:"",archive_court_order_file:null}),b=u.useMemo(()=>{let s=V.filter(a=>a.pdl);return R&&(s=s.filter(a=>{var w,O,L,k,E,T,me;const r=a.pdl,d=`${(r==null?void 0:r.fname)||""} ${(r==null?void 0:r.mname)||""} ${(r==null?void 0:r.lname)||""}`.toLowerCase(),n=R.toLowerCase();return d.includes(n)||((w=r.alias)==null?void 0:w.toLowerCase().includes(n))||((O=r.gender)==null?void 0:O.toLowerCase().includes(n))||((L=r.ethnic_group)==null?void 0:L.toLowerCase().includes(n))||((k=r.civil_status)==null?void 0:k.toLowerCase().includes(n))||((E=r.brgy)==null?void 0:E.toLowerCase().includes(n))||((T=r.city)==null?void 0:T.toLowerCase().includes(n))||((me=r.province)==null?void 0:me.toLowerCase().includes(n))||r.id.toString().includes(n)})),s.sort((a,r)=>{var w,O,L,k,E,T;let d,n;switch(_){case"name":d=`${a.pdl.fname} ${a.pdl.mname} ${a.pdl.lname}`.toLowerCase(),n=`${r.pdl.fname} ${r.pdl.mname} ${r.pdl.lname}`.toLowerCase();break;case"id":d=a.pdl.id,n=r.pdl.id;break;case"gender":d=((w=a.pdl.gender)==null?void 0:w.toLowerCase())||"",n=((O=r.pdl.gender)==null?void 0:O.toLowerCase())||"";break;case"ethnic_group":d=((L=a.pdl.ethnic_group)==null?void 0:L.toLowerCase())||"",n=((k=r.pdl.ethnic_group)==null?void 0:k.toLowerCase())||"";break;case"civil_status":d=((E=a.pdl.civil_status)==null?void 0:E.toLowerCase())||"",n=((T=r.pdl.civil_status)==null?void 0:T.toLowerCase())||"";break;case"age":d=le(a.pdl.birthdate),n=le(r.pdl.birthdate);break;default:d=a.pdl[_],n=r.pdl[_]}return d<n?D==="asc"?-1:1:d>n?D==="asc"?1:-1:0}),s},[V,R,_,D]),g=Math.ceil(b.length/A),$=(j-1)*A,Se=b.slice($,$+A),y=s=>{_===s?ne(D==="asc"?"desc":"asc"):(fe(s),ne("asc")),f(1)},S=({field:s})=>_!==s?null:D==="asc"?e.jsx(Me,{className:"w-4 h-4"}):e.jsx(Ie,{className:"w-4 h-4"}),De=s=>{pe(s),N({archive_status:"",archive_reason:"",archive_court_order_type:"",archive_court_order_file:null}),P(!0)},Ae=()=>{t&&Ne(route("pdl.custody-dates",t.id),{onSuccess:()=>{q(!1),K({admission_date:"",release_date:""})},onError:s=>{console.error("Custody dates update errors:",s)}})},we=()=>{t&&be(route("pdl.court-order-update",t.id),{onSuccess:()=>{J(!1),v({court_order_number:"",order_type:"",order_date:"",received_date:"",remarks:"",document_type:"",court_branch:""})},onError:s=>{console.error("Court order update errors:",s)}})},Oe=()=>{t&&(console.log("Submitting archive data:",p),console.log("Selected PDL:",t),console.log("Route URL:",route("pdl.archive",t.id)),ye(route("pdl.archive",t.id),{onSuccess:s=>{console.log("Archive successful",s),N({archive_status:"",archive_reason:"",archive_court_order_type:"",archive_court_order_file:null})},onError:s=>{console.error("Archive errors:",s)},onFinish:()=>{console.log("Archive request finished")}}))},F=U.success;return e.jsxs(Fe,{breadcrumbs:Ke,children:[e.jsx(ke,{title:"Personal Information"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Personal Information"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-start sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(ze,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search PDLs...",value:R,onChange:s=>{_e(s.target.value),f(1)},className:"pl-8"})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Show:"}),e.jsxs(se,{value:A.toString(),onValueChange:s=>{Ce(Number(s)),f(1)},children:[e.jsx(re,{className:"w-20",children:e.jsx(ae,{})}),e.jsxs(te,{children:[e.jsx(c,{value:"10",children:"10"}),e.jsx(c,{value:"25",children:"25"}),e.jsx(c,{value:"50",children:"50"}),e.jsx(c,{value:"100",children:"100"})]})]})]}),!G&&e.jsx(Ee,{href:"/pdl-management/personal-information/create",className:"flex items-center gap-2 rounded-sm bg-blue-500 px-4 py-2 text-sm text-white hover:bg-blue-600",children:"Add PDL Information"})]})]}),e.jsxs(Te,{children:[e.jsx(Pe,{children:e.jsxs(Re,{children:["Personal Information List",e.jsxs("span",{className:"text-sm font-normal text-muted-foreground ml-2",children:["(",b.length," PDL",b.length!==1?"s":"",")"]})]})}),e.jsxs($e,{children:[e.jsxs(Be,{children:[e.jsx(Ue,{children:e.jsxs(ue,{children:[e.jsx(h,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>y("id"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["ID",e.jsx(S,{field:"id"})]})}),e.jsx(h,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>y("name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Full Name",e.jsx(S,{field:"name"})]})}),e.jsx(h,{children:"Alias"}),e.jsx(h,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>y("gender"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Gender",e.jsx(S,{field:"gender"})]})}),e.jsx(h,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>y("ethnic_group"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Ethnic Group",e.jsx(S,{field:"ethnic_group"})]})}),e.jsx(h,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>y("civil_status"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Civil Status",e.jsx(S,{field:"civil_status"})]})}),e.jsx(h,{children:"Date of Birth"}),e.jsx(h,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>y("age"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Age",e.jsx(S,{field:"age"})]})}),e.jsx(h,{children:"Address"}),e.jsx(h,{children:"Encoded By"}),e.jsx(h,{children:"Agency"}),e.jsx(h,{children:"Actions"})]})}),e.jsx(Ve,{children:Se.map(s=>{var a,r;return e.jsxs(ue,{children:[e.jsx(m,{children:s.pdl.id}),e.jsx(m,{children:`${((a=s==null?void 0:s.pdl)==null?void 0:a.fname)||""} ${(s==null?void 0:s.pdl.mname)||""}  ${((r=s==null?void 0:s.pdl)==null?void 0:r.lname)||""}`.trim().split(" ").filter(Boolean).map(d=>d.charAt(0).toUpperCase()+d.slice(1).toLowerCase()).join(" ")}),e.jsx(m,{children:s.pdl.alias??"-"}),e.jsx(m,{children:s.pdl.gender??"-"}),e.jsx(m,{children:s.pdl.ethnic_group??"-"}),e.jsx(m,{children:s.pdl.civil_status??"-"}),e.jsx(m,{children:Je(new Date(s.pdl.birthdate),"MMMM dd, yyyy")}),e.jsx(m,{children:le(s.pdl.birthdate)}),e.jsx(m,{children:`${s.pdl.brgy??""}, ${s.pdl.city??""}, ${s.pdl.province??""}`}),e.jsx(m,{children:s.pdl.personnel?`${s.pdl.personnel.fname} ${s.pdl.personnel.lname}`:"—"}),e.jsx(m,{children:s.pdl.personnel?`${s.pdl.personnel.agency}`:"—"}),e.jsxs(m,{className:"space-x-1",children:[e.jsx(He,{pdl:s.pdl}),!G&&e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>De(s.pdl),children:[e.jsx(Ge,{className:"mr-1 h-4 w-4"}),"Archive"]}),!G&&e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>{window.location.href=`/record-officer/pdl-management/personal-information/${s.pdl.id}`},children:[e.jsx(qe,{className:"mr-1 h-4 w-4"}),"Edit"]})]})]},s.pdl.id)})})]}),g>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",$+1," to ",Math.min($+A,b.length)," of ",b.length," entries"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>f(s=>Math.max(s-1,1)),disabled:j===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,g)},(s,a)=>{let r;return g<=5||j<=3?r=a+1:j>=g-2?r=g-4+a:r=j-2+a,e.jsx(i,{variant:j===r?"default":"outline",size:"sm",onClick:()=>f(r),children:r},r)})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>f(s=>Math.min(s+1,g)),disabled:j===g,children:"Next"})]})]})]})]}),e.jsx(W,{open:je,onOpenChange:q,children:e.jsxs(X,{children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Manage Custody Dates"}),e.jsxs(ee,{children:["Update admission and release dates for ",t==null?void 0:t.fname," ",t==null?void 0:t.lname]})]}),e.jsxs("div",{className:"space-y-4",children:[Object.keys(l).length>0&&e.jsxs(I,{variant:"destructive",className:"mt-4 mb-4",children:[e.jsx(M,{children:"Unable to process request"}),e.jsx(B,{children:Object.values(l).map((s,a)=>e.jsx("ul",{className:"list-inside list-disc text-sm",children:e.jsx("li",{children:s})},a))})]}),F&&e.jsxs(I,{variant:"default",className:"mb-4",children:[e.jsx(M,{children:"Success"}),e.jsx(B,{children:F})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"admission_date",children:"Admission Date"}),e.jsx(x,{id:"admission_date",type:"date",value:ce.admission_date,onChange:s=>K("admission_date",s.target.value),className:l!=null&&l.admission_date?"border-red-500":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"release_date",children:"Release Date"}),e.jsx(x,{id:"release_date",type:"date",value:ce.release_date,onChange:s=>K("release_date",s.target.value),className:l!=null&&l.release_date?"border-red-500":""})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(i,{variant:"outline",onClick:()=>q(!1),children:"Cancel"}),e.jsx(i,{onClick:Ae,disabled:de,children:de?"Updating...":"Update Dates"})]})]})]})}),e.jsx(W,{open:ve,onOpenChange:J,children:e.jsxs(X,{children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Update Court Order"}),e.jsxs(ee,{children:["Update court order information for ",t==null?void 0:t.fname," ",t==null?void 0:t.lname]})]}),e.jsxs("div",{className:"space-y-4",children:[Object.keys(l).length>0&&e.jsxs(I,{variant:"destructive",className:"mt-4 mb-4",children:[e.jsx(M,{children:"Unable to process request"}),e.jsx(B,{children:Object.values(l).map((s,a)=>e.jsx("ul",{className:"list-inside list-disc text-sm",children:e.jsx("li",{children:s})},a))})]}),F&&e.jsxs(I,{variant:"default",className:"mb-4",children:[e.jsx(M,{children:"Success"}),e.jsx(B,{children:F})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"court_order_number",children:"Court Order Number"}),e.jsx(x,{id:"court_order_number",value:C.court_order_number,onChange:s=>v("court_order_number",s.target.value),className:l!=null&&l.court_order_number?"border-red-500":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"order_type",children:"Order Type"}),e.jsx(x,{id:"order_type",value:C.order_type,onChange:s=>v("order_type",s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"order_date",children:"Order Date"}),e.jsx(x,{id:"order_date",type:"date",value:C.order_date,onChange:s=>v("order_date",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"received_date",children:"Received Date"}),e.jsx(x,{id:"received_date",type:"date",value:C.received_date,onChange:s=>v("received_date",s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"court_branch",children:"Court Branch"}),e.jsx(x,{id:"court_branch",value:C.court_branch,onChange:s=>v("court_branch",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"remarks",children:"Remarks"}),e.jsx(xe,{id:"remarks",value:C.remarks,onChange:s=>v("remarks",s.target.value),rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(i,{variant:"outline",onClick:()=>J(!1),children:"Cancel"}),e.jsx(i,{onClick:we,disabled:ie,children:ie?"Updating...":"Update Court Order"})]})]})]})}),e.jsx(W,{open:ge,onOpenChange:P,children:e.jsxs(X,{className:"max-w-2xl",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Archive PDL"}),e.jsxs(ee,{children:["Archive ",t==null?void 0:t.fname," ",t==null?void 0:t.lname]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"archive_status",children:"Archive Status *"}),e.jsxs(se,{value:p.archive_status,onValueChange:s=>N("archive_status",s),children:[e.jsx(re,{className:l!=null&&l.archive_status?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select archive status"})}),e.jsxs(te,{children:[e.jsx(c,{value:"SERVED_SENTENCE",children:"Served Sentence"}),e.jsx(c,{value:"BONDED",children:"BONDED"}),e.jsx(c,{value:"TRANSFERRED_TO_OTHER_JAIL",children:"Transferred to Another Jail"}),e.jsx(c,{value:"DISMISSED",children:"Dismissed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"archive_reason",children:"Reason for Archiving *"}),e.jsx(xe,{id:"archive_reason",placeholder:"Enter the reason for archiving this PDL record...",value:p.archive_reason,onChange:s=>N("archive_reason",s.target.value),rows:3,className:l!=null&&l.archive_reason?"border-red-500":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"archive_court_order_type",children:"Court Order Type *"}),e.jsxs(se,{value:p.archive_court_order_type,onValueChange:s=>N("archive_court_order_type",s),children:[e.jsx(re,{className:l!=null&&l.archive_court_order_type?"border-red-500":"",children:e.jsx(ae,{placeholder:"Select court order type"})}),e.jsxs(te,{children:[e.jsx(c,{value:"RELEASE",children:"Release Order"}),e.jsx(c,{value:"BAIL",children:"Bail Order"}),e.jsx(c,{value:"SERVED_SENTENCE",children:"Served Sentence"}),e.jsx(c,{value:"PROBATION",children:"Probation Order"}),e.jsx(c,{value:"PAROLE",children:"Parole Order"}),e.jsx(c,{value:"TRANSFER",children:"Transfer Order"}),e.jsx(c,{value:"OTHER",children:"Other Court Order"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"archive_court_order_file",children:"Court Order Document *"}),e.jsx(x,{id:"archive_court_order_file",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:s=>{var a;return N("archive_court_order_file",((a=s.target.files)==null?void 0:a[0])||null)},className:l!=null&&l.archive_court_order_file?"border-red-500":""}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload PDF, JPG, JPEG, or PNG file (max 10MB)"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(i,{variant:"outline",onClick:()=>P(!1),children:"Cancel"}),H!=null&&H.success?e.jsx(i,{onClick:()=>P(!1),children:"Close"}):e.jsx(i,{onClick:Oe,disabled:oe||!p.archive_status||!p.archive_reason||!p.archive_court_order_type||!p.archive_court_order_file,children:oe?"Archiving...":"Archive PDL"})]})]})]})})]})]})}export{ys as default};
