import{r as i,j as e,S as L,K,L as U}from"./app-C1edxtTp.js";import{D as W}from"./data-table-L9tttZz6.js";import{c as J,B as v}from"./button-DrzaVBtD.js";import{C as Q,a as X,b as Y,c as Z}from"./card-B-C90cye.js";import{I as $}from"./input-CvEaa6Sx.js";import{L as y}from"./label-BnBrlq29.js";import{S as w,a as A,b as P,c as T,d as b}from"./select-CrdmFyDT.js";import{D as V,g as R,a as z,b as H,c as B,t as N,d as ee,A as se}from"./app-layout-BllnXnPm.js";import{T as le}from"./textarea-qUilH148.js";import{C as te}from"./checkbox-DpTaeQ_l.js";import{A as M,b as G,a as E}from"./alert-DRWOZzF4.js";import"./table-BZK2ALiX.js";import"./index-uHaqmIww.js";import"./index-W7eYi-Gp.js";import"./index-B77BIdjF.js";import"./index-D-fkcTgw.js";import"./index-ByaXkLAF.js";import"./users-BkaoQLnE.js";import"./user-DCPe4-sj.js";import"./scale-jlxygnyf.js";import"./eye-DTBbKAYB.js";import"./index-D0Sz3_e6.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],ae=J("ArrowRightLeft",re);function q({assignment:a,cells:j=[]}){const[S,p]=i.useState(!1),[n,c]=i.useState(""),[m,d]=i.useState(""),[o,f]=i.useState(!1),[h,x]=i.useState({}),g=j.filter(r=>r.cell_id!==a.cell_id&&r.gender.toLowerCase()===a.cell_gender.toLowerCase()),t=async()=>{if(!n){N.error("Please select a destination cell");return}f(!0),x({});try{L.post("/pdl-management/cell-assignment/transfer",{assignment_id:a.assignment_id,to_cell_id:n,reason:m},{onSuccess:()=>{p(!1),c(""),d(""),x({}),N.success("PDL transferred successfully")},onError:r=>{if(f(!1),r&&typeof r=="object"){x(r);const D=Object.values(r)[0];D&&N.error(D)}else N.error("Failed to transfer PDL")}})}catch(r){f(!1),console.error("Transfer error:",r),N.error("An unexpected error occurred during transfer")}},u=r=>{r||(c(""),d(""),x({})),p(r)},_=j.find(r=>r.cell_id.toString()===n);return e.jsxs(V,{open:S,onOpenChange:u,children:[e.jsx(R,{asChild:!0,children:e.jsxs(v,{variant:"outline",size:"sm",children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Transfer"]})}),e.jsxs(z,{className:"sm:max-w-md",children:[e.jsx(H,{children:e.jsx(B,{children:"Transfer PDL to Another Cell"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{className:"text-sm font-medium",children:"PDL"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.pdl_name})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-sm font-medium",children:"Current Cell"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.cell_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"destination-cell",children:"Destination Cell"}),e.jsxs(w,{value:n,onValueChange:c,children:[e.jsx(A,{children:e.jsx(P,{placeholder:"Select destination cell"})}),e.jsx(T,{children:g.map(r=>e.jsxs(b,{value:r.cell_id.toString(),children:[r.cell_name," (",r.gender,") - Capacity: ",r.capacity]},r.cell_id))})]}),g.length===0&&e.jsx("p",{className:"text-sm text-red-600",children:"No available cells with matching gender"}),_&&_.gender.toLowerCase()!==a.cell_gender.toLowerCase()&&e.jsxs("p",{className:"text-sm text-yellow-600",children:["Warning: Selected cell gender (",_.gender,") doesn't match PDL gender (",a.cell_gender,")"]}),h.to_cell_id&&e.jsx("p",{className:"text-sm text-red-600",children:h.to_cell_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"reason",children:"Transfer Reason (Optional)"}),e.jsx(le,{id:"reason",placeholder:"Enter reason for transfer...",value:m,onChange:r=>d(r.target.value),rows:3}),h.reason&&e.jsx("p",{className:"text-sm text-red-600",children:h.reason})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(v,{variant:"outline",onClick:()=>p(!1),disabled:o,children:"Cancel"}),e.jsx(v,{onClick:t,disabled:!n||o||g.length===0,children:o?"Transferring...":"Transfer PDL"})]})]})]})]})}const ne=[{accessorKey:"assignment_id",header:"Assignment ID"},{accessorKey:"cell_number",header:"Cell Number"},{accessorKey:"cell_id",header:"Cell ID"},{accessorKey:"pdl_id",header:"PDL ID"},{accessorKey:"pdl_name",header:"PDL Name"},{accessorKey:"assigned_date",header:"Assigned Date",cell:({row:a})=>new Date(a.original.assigned_date).toLocaleDateString()},{id:"actions",header:"Actions",cell:({row:a})=>{const j=a.original;return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(q,{assignment:j})})}}];function ie({cells:a,pdls:j}){const[S,p]=i.useState(!1),[n,c]=i.useState(""),[m,d]=i.useState([]),[o,f]=i.useState(""),[h,x]=i.useState("all"),g=i.useMemo(()=>{let s=j;if(o&&(s=s.filter(l=>`${l.fname} ${l.lname}`.toLowerCase().includes(o.toLowerCase())||l.id.toString().includes(o))),n){const l=a.find(C=>C.cell_id.toString()===n);l&&(s=s.filter(C=>{var I;return((I=C.gender)==null?void 0:I.toLowerCase())===l.gender}))}return s},[j,o,n,a]),t=i.useMemo(()=>{let s=a;return h!=="all"&&(s=s.filter(l=>l.gender===h)),s},[a,h]),u=s=>{c(s),d([])},_=()=>{!n||m.length===0||L.post(route("cell-assignments.store"),{cell_id:n,pdl_ids:m},{onSuccess:()=>{p(!1),c(""),d([]),f(""),x("all")}})},r=s=>{d(l=>l.includes(s)?l.filter(C=>C!==s):[...l,s])},D=()=>{const s=g.map(l=>l.id);d(l=>s.every(C=>l.includes(C))?l.filter(C=>!s.includes(C)):[...new Set([...l,...s])])},{props:k}=K(),F=k.success,O=k.errors||{};return e.jsxs(V,{open:S,onOpenChange:p,children:[e.jsx(R,{asChild:!0,children:e.jsx(v,{children:"Assign PDL to Cell"})}),e.jsxs(z,{className:"max-h-[80vh] max-w-3xl overflow-y-auto",children:[e.jsxs(H,{children:[e.jsx(B,{children:"Assign PDLs to Cell"}),e.jsx(ee,{children:"Select a cell and choose PDLs to assign to it."})]}),Object.keys(O).length>0&&e.jsx("div",{"data-alert-container":!0,className:"relative",children:e.jsxs(M,{variant:"destructive",children:[e.jsx("button",{type:"button","aria-label":"Close",onClick:s=>{const l=s.currentTarget.closest("[data-alert-container]")||void 0;l&&(l.style.display="none")},className:"absolute top-2 right-2 rounded p-1 text-lg leading-none hover:bg-muted",children:"×"}),e.jsx(G,{children:"Unable to process request"}),e.jsx(E,{children:e.jsx("ul",{className:"list-inside list-disc space-y-1",children:Object.values(O).map((s,l)=>e.jsx("li",{className:"text-sm",children:s},l))})})]})}),F&&e.jsx("div",{"data-alert-container":!0,className:"relative",ref:s=>{if(!s)return;s.style.display="";const l=s;l._timer&&clearTimeout(l._timer),l._timer=setTimeout(()=>{s.style.display="none"},3e3)},children:e.jsxs(M,{children:[e.jsx("button",{type:"button","aria-label":"Close",onClick:s=>{const l=s.currentTarget.closest("[data-alert-container]")||void 0;l&&(l.style.display="none")},className:"absolute top-2 right-2 rounded p-1 text-sm leading-none hover:bg-muted",children:"×"}),e.jsx(G,{children:"Success"}),e.jsx(E,{children:F})]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"gender-filter",children:"Filter by Gender"}),e.jsxs(w,{value:h,onValueChange:x,children:[e.jsx(A,{children:e.jsx(P,{placeholder:"Select gender filter"})}),e.jsxs(T,{children:[e.jsx(b,{value:"all",children:"All Genders"}),e.jsx(b,{value:"male",children:"Male Only"}),e.jsx(b,{value:"female",children:"Female Only"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"cell",children:"Select Cell"}),e.jsxs(w,{value:n,onValueChange:u,children:[e.jsx(A,{children:e.jsx(P,{placeholder:"Choose a cell"})}),e.jsx(T,{children:t.map(s=>e.jsxs(b,{value:s.cell_id.toString(),children:[s.cell_name," (Capacity: ",s.capacity,", Gender: ",s.gender,")"]},s.cell_id))})]})]}),n&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{htmlFor:"pdl-search",children:"Select PDLs"}),e.jsx(v,{variant:"outline",size:"sm",onClick:D,disabled:g.length===0,children:"Toggle All Filtered"})]}),e.jsx($,{id:"pdl-search",placeholder:"Search PDLs by name or ID",value:o,onChange:s=>f(s.target.value)}),n&&e.jsxs("div",{className:"text-sm text-gray-600 bg-blue-50 p-2 rounded",children:[e.jsx("strong",{children:"Note:"})," Only PDLs matching the selected cell's gender are shown.",(()=>{const s=a.find(l=>l.cell_id.toString()===n);return s?` Showing ${s.gender} PDLs only.`:""})()]}),e.jsx("div",{className:"max-h-60 overflow-y-auto rounded-md border p-2",children:g.length>0?g.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-gray-50",children:[e.jsx(te,{id:`pdl-${s.id}`,checked:m.includes(s.id),onCheckedChange:()=>r(s.id)}),e.jsxs("label",{htmlFor:`pdl-${s.id}`,className:"text-sm leading-none font-medium peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:[s.fname," ",s.lname," (ID: ",s.id,") ",s.gender]})]},s.id)):e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:n?"No PDLs available for the selected cell gender.":o?"No PDLs match your search":"No PDLs available"})}),m.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Selected: ",m.length," PDL(s)"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(v,{onClick:_,disabled:!n||m.length===0,children:"Assign Selected"})]})]})]})}function Te(){const{props:a}=K(),{assignments:j,cells:S,pdls:p,filters:n}=a,[c,m]=i.useState(n.search||""),[d,o]=i.useState("all"),f=j.map(t=>({assignment_id:t.assignment_id,cell_number:t.cell.cell_name,cell_id:t.cell.cell_id,cell_gender:t.cell.gender,pdl_id:t.pdl.id,pdl_name:`${t.pdl.fname} ${t.pdl.lname}`,pdl_gender:t.pdl.gender,assigned_date:t.created_at})),h=i.useMemo(()=>{let t=f;return c&&(t=t.filter(u=>u.cell_number.toLowerCase().includes(c.toLowerCase())||u.pdl_name.toLowerCase().includes(c.toLowerCase()))),d!=="all"&&(t=t.filter(u=>u.cell_gender===d)),t},[f,c,d]),x=()=>{L.get("/admin/pdl-management/cell-assignment",{search:c})},g=[{title:"Cell Management",href:"/cell-management"},{title:"Assignments",href:"/record-officer/pdl-management/cell-assignment"}];return e.jsxs(se,{breadcrumbs:g,children:[e.jsx(U,{title:"Cell Assignment Management"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Cell Assignments"}),e.jsxs(Q,{children:[e.jsx(X,{children:e.jsx(Y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Cell Assignment List"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{variant:"outline",onClick:()=>L.get("/record-officer/pdl-management/cell-activity-log"),children:"View Activity Log"}),e.jsx(ie,{cells:S,pdls:p})]})]})})}),e.jsxs(Z,{children:[e.jsxs("div",{className:"mb-4 flex items-center space-x-4",children:[e.jsx(y,{htmlFor:"search",className:"text-sm font-medium",children:"Search Assignments"}),e.jsx($,{id:"search",placeholder:"Search by cell number or PDL name",className:"w-64",value:c,onChange:t=>m(t.target.value),onKeyDown:t=>t.key==="Enter"&&x()}),e.jsx(v,{variant:"outline",onClick:x,children:"Search"})]}),e.jsxs("div",{className:"mb-4 flex items-center space-x-4",children:[e.jsx(y,{htmlFor:"gender-filter",className:"text-sm font-medium",children:"Filter by Gender"}),e.jsxs(w,{value:d,onValueChange:o,children:[e.jsx(A,{className:"w-48",children:e.jsx(P,{placeholder:"Select gender filter"})}),e.jsxs(T,{children:[e.jsx(b,{value:"all",children:"All Genders"}),e.jsx(b,{value:"male",children:"Male Only"}),e.jsx(b,{value:"female",children:"Female Only"})]})]})]}),e.jsx(W,{columns:ne.map(t=>t.id==="actions"?{...t,cell:({row:u})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(q,{assignment:u.original,cells:S})})}:t),data:h})]})]})]})]})}export{Te as default};
