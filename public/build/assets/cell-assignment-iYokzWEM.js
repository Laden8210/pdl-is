import{r as d,j as e,S as L,K as G,L as J}from"./app-BPxrKEyb.js";import{D as Q}from"./data-table-CnUSCmLf.js";import{c as X,B as p}from"./button-CEMgu7CE.js";import{C as Y,a as Z,b as ee,c as se}from"./card-MY-iCpFz.js";import{I as V}from"./input-CvRLkRAD.js";import{L as j}from"./label-BHAojcQv.js";import{S as w,a as A,b as P,c as T,d as b}from"./select-Dq-Ok0hR.js";import{D as R,i as z,a as H,b as B,c as U,x as D,d as le,A as te}from"./app-layout-B7fNkZnx.js";import{T as ae}from"./textarea-C2McMECy.js";import{C as re}from"./checkbox-qAUtApyq.js";import{A as K,b as $,a as E}from"./alert-Dy7BgFLC.js";import"./table-Da5D_Wo2.js";import"./index-D55dR1IO.js";import"./index-Bwm_JLZs.js";import"./index-xw3hog76.js";import"./index-B8miVs9F.js";import"./index-DXqzBNPn.js";import"./users-HviPfwPA.js";import"./user-DBhr3jVO.js";import"./scale-CeClP0FS.js";import"./eye-DJMTalI9.js";import"./circle-alert-BcedVOno.js";import"./index-DEilKMl9.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],ie=X("ArrowRightLeft",ne);function q({assignment:a,cells:n=[]}){const[S,x]=d.useState(!1),[r,C]=d.useState(""),[i,g]=d.useState(""),[c,v]=d.useState(!1),[o,u]=d.useState({}),m=n.filter(l=>l.cell_id!==a.cell_id&&l.gender.toLowerCase()===a.cell_gender.toLowerCase()),N=async()=>{if(!r){D.error("Please select a destination cell");return}v(!0),u({});try{L.post("/pdl-management/cell-assignment/transfer",{assignment_id:a.assignment_id,to_cell_id:r,reason:i},{onSuccess:()=>{x(!1),C(""),g(""),u({}),D.success("PDL transferred successfully")},onError:l=>{if(v(!1),l&&typeof l=="object"){u(l);const h=Object.values(l)[0];h&&D.error(h)}else D.error("Failed to transfer PDL")}})}catch(l){v(!1),console.error("Transfer error:",l),D.error("An unexpected error occurred during transfer")}},_=l=>{l||(C(""),g(""),u({})),x(l)},y=n.find(l=>l.cell_id.toString()===r);return e.jsxs(R,{open:S,onOpenChange:_,children:[e.jsx(z,{asChild:!0,children:e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Transfer"]})}),e.jsxs(H,{className:"sm:max-w-md",children:[e.jsx(B,{children:e.jsx(U,{children:"Transfer PDL to Another Cell"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-sm font-medium",children:"PDL"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.pdl_name})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm font-medium",children:"Current Cell"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.cell_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"destination-cell",children:"Destination Cell"}),e.jsxs(w,{value:r,onValueChange:C,children:[e.jsx(A,{children:e.jsx(P,{placeholder:"Select destination cell"})}),e.jsx(T,{children:m.map(l=>e.jsxs(b,{value:l.cell_id.toString(),children:[l.cell_name," (",l.gender,") - Capacity: ",l.capacity," - Classification : ",l.classification]},l.cell_id))})]}),m.length===0&&e.jsx("p",{className:"text-sm text-red-600",children:"No available cells with matching gender"}),y&&y.gender.toLowerCase()!==a.cell_gender.toLowerCase()&&e.jsxs("p",{className:"text-sm text-yellow-600",children:["Warning: Selected cell gender (",y.gender,") doesn't match PDL gender (",a.cell_gender,")"]}),o.to_cell_id&&e.jsx("p",{className:"text-sm text-red-600",children:o.to_cell_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"reason",children:"Transfer Reason (Optional)"}),e.jsx(ae,{id:"reason",placeholder:"Enter reason for transfer...",value:i,onChange:l=>g(l.target.value),rows:3}),o.reason&&e.jsx("p",{className:"text-sm text-red-600",children:o.reason})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(p,{variant:"outline",onClick:()=>x(!1),disabled:c,children:"Cancel"}),e.jsx(p,{onClick:N,disabled:!r||c||m.length===0,children:c?"Transferring...":"Transfer PDL"})]})]})]})]})}const ce=[{accessorKey:"assignment_id",header:"Assignment ID"},{accessorKey:"cell_number",header:"Cell Number"},{accessorKey:"cell_id",header:"Cell ID"},{accessorKey:"pdl_id",header:"PDL ID"},{accessorKey:"pdl_name",header:"PDL Name"},{accessorKey:"pdl_classification",header:"PDL Classification",cell:({row:a})=>a.original.pdl_classification.replace(/\b\w/g,n=>n.toUpperCase())},{accessorKey:"assigned_date",header:"Assigned Date",cell:({row:a})=>new Date(a.original.assigned_date).toLocaleDateString()},{id:"actions",header:"Actions",cell:({row:a})=>{const n=a.original;return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(q,{assignment:n})})}}];function de({cells:a,pdls:n}){console.log("PDLs received:",n);const[S,x]=d.useState(!1),[r,C]=d.useState(""),[i,g]=d.useState([]),[c,v]=d.useState(""),[o,u]=d.useState("all"),m=d.useMemo(()=>{let s=n;if(c&&(s=s.filter(t=>`${t.fname} ${t.lname}`.toLowerCase().includes(c.toLowerCase())||t.id.toString().includes(c))),r){const t=a.find(f=>f.cell_id.toString()===r);t&&(s=s.filter(f=>{var I,M;const W=(I=f.gender)==null?void 0:I.toLowerCase();return(M=f.classification)==null||M.toLowerCase(),W===t.gender}))}return s},[n,c,r,a]),N=d.useMemo(()=>{let s=a;return o!=="all"&&(s=s.filter(t=>t.gender===o)),s},[a,o]),_=s=>{C(s),g([])},y=()=>{!r||i.length===0||L.post(route("cell-assignments.store"),{cell_id:r,pdl_ids:i},{onSuccess:()=>{x(!1),C(""),g([]),v(""),u("all")}})},l=s=>{g(t=>t.includes(s)?t.filter(f=>f!==s):[...t,s])},h=()=>{const s=m.map(t=>t.id);g(t=>s.every(f=>t.includes(f))?t.filter(f=>!s.includes(f)):[...new Set([...t,...s])])},{props:k}=G(),F=k.success,O=k.errors||{};return e.jsxs(R,{open:S,onOpenChange:x,children:[e.jsx(z,{asChild:!0,children:e.jsx(p,{children:"Assign PDL to Cell"})}),e.jsxs(H,{className:"max-h-[80vh] max-w-3xl overflow-y-auto",children:[e.jsxs(B,{children:[e.jsx(U,{children:"Assign PDLs to Cell"}),e.jsx(le,{children:"Select a cell and choose PDLs to assign to it."})]}),Object.keys(O).length>0&&e.jsx("div",{"data-alert-container":!0,className:"relative",children:e.jsxs(K,{variant:"destructive",children:[e.jsx("button",{type:"button","aria-label":"Close",onClick:s=>{const t=s.currentTarget.closest("[data-alert-container]")||void 0;t&&(t.style.display="none")},className:"absolute top-2 right-2 rounded p-1 text-lg leading-none hover:bg-muted",children:"×"}),e.jsx($,{children:"Unable to process request"}),e.jsx(E,{children:e.jsx("ul",{className:"list-inside list-disc space-y-1",children:Object.values(O).map((s,t)=>e.jsx("li",{className:"text-sm",children:s},t))})})]})}),F&&e.jsx("div",{"data-alert-container":!0,className:"relative",ref:s=>{if(!s)return;s.style.display="";const t=s;t._timer&&clearTimeout(t._timer),t._timer=setTimeout(()=>{s.style.display="none"},3e3)},children:e.jsxs(K,{children:[e.jsx("button",{type:"button","aria-label":"Close",onClick:s=>{const t=s.currentTarget.closest("[data-alert-container]")||void 0;t&&(t.style.display="none")},className:"absolute top-2 right-2 rounded p-1 text-sm leading-none hover:bg-muted",children:"×"}),e.jsx($,{children:"Success"}),e.jsx(E,{children:F})]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"gender-filter",children:"Filter by Gender"}),e.jsxs(w,{value:o,onValueChange:u,children:[e.jsx(A,{children:e.jsx(P,{placeholder:"Select gender filter"})}),e.jsxs(T,{children:[e.jsx(b,{value:"all",children:"All Genders"}),e.jsx(b,{value:"male",children:"Male Only"}),e.jsx(b,{value:"female",children:"Female Only"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"cell",children:"Select Cell"}),e.jsxs(w,{value:r,onValueChange:_,children:[e.jsx(A,{children:e.jsx(P,{placeholder:"Choose a cell"})}),e.jsx(T,{children:N.map(s=>e.jsxs(b,{value:s.cell_id.toString(),children:[s.cell_name," (Capacity: ",s.capacity,", Gender: ",s.gender,", Classification: ",s.classification,")"]},s.cell_id))})]})]}),r&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(j,{htmlFor:"pdl-search",children:"Select PDLs"}),e.jsx(p,{variant:"outline",size:"sm",onClick:h,disabled:m.length===0,children:"Toggle All Filtered"})]}),e.jsx(V,{id:"pdl-search",placeholder:"Search PDLs by name or ID",value:c,onChange:s=>v(s.target.value)}),r&&e.jsxs("div",{className:"text-sm text-gray-600 bg-blue-50 p-2 rounded",children:[e.jsx("strong",{children:"Note:"})," Only PDLs matching the selected cell's gender are shown.",(()=>{const s=a.find(t=>t.cell_id.toString()===r);return s?` Showing ${s.gender} PDLs only.`:""})()]}),e.jsx("div",{className:"max-h-60 overflow-y-auto rounded-md border p-2",children:m.length>0?m.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-gray-50",children:[e.jsx(re,{id:`pdl-${s.id}`,checked:i.includes(s.id),onCheckedChange:()=>l(s.id)}),e.jsxs("label",{htmlFor:`pdl-${s.id}`,className:"text-sm leading-none font-medium peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:[s.fname," ",s.lname," (ID: ",s.id,") ",s.gender," ",e.jsx("br",{}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Classification: ",s.classification]})]})]},s.id)):e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:r?"No PDLs available for the selected cell gender.":c?"No PDLs match your search":"No PDLs available"})}),i.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Selected: ",i.length," PDL(s)"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(p,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(p,{onClick:y,disabled:!r||i.length===0,children:"Assign Selected"})]})]})]})}function Fe(){var _,y;const{props:a}=G(),{auth:n}=a,{assignments:S,cells:x,pdls:r,filters:C}=a,[i,g]=d.useState(C.search||""),[c,v]=d.useState("all"),o=S.map(l=>({assignment_id:l.assignment_id,cell_number:l.cell.cell_name,cell_id:l.cell.cell_id,cell_gender:l.cell.gender,pdl_id:l.pdl.id,pdl_name:`${l.pdl.fname} ${l.pdl.mname||""} ${l.pdl.lname} ${l.pdl.suffix||""}`,pdl_gender:l.pdl.gender,assigned_date:l.created_at,pdl_classification:l.cell.classification})),u=d.useMemo(()=>{let l=o;return i&&(l=l.filter(h=>h.cell_number.toLowerCase().includes(i.toLowerCase())||h.pdl_name.toLowerCase().includes(i.toLowerCase()))),c!=="all"&&(l=l.filter(h=>h.cell_gender===c)),l},[o,i,c]),m=()=>{L.get("/admin/pdl-management/cell-assignment",{search:i})},N=[{title:"Cell Management",href:"/cell-management"},{title:"Assignments",href:"/record-officer/pdl-management/cell-assignment"}];return console.log("Filtered Assignments:",u),e.jsxs(te,{breadcrumbs:N,children:[e.jsx(J,{title:"Cell Assignment Management"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Cell Assignments"}),e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsx(ee,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Cell Assignment List"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[((_=n==null?void 0:n.user)==null?void 0:_.position)==="admin"&&e.jsx(p,{variant:"outline",onClick:()=>L.get("/admin/pdl-management/cell-activity-log"),children:"View Activity Log"}),((y=n==null?void 0:n.user)==null?void 0:y.position)==="record-officer"&&e.jsx(p,{variant:"outline",onClick:()=>L.get("/record-officer/pdl-management/cell-activity-log"),children:"View Activity Log"}),e.jsx(de,{cells:x,pdls:r})]})]})})}),e.jsxs(se,{children:[e.jsxs("div",{className:"mb-4 flex items-center space-x-4",children:[e.jsx(j,{htmlFor:"search",className:"text-sm font-medium",children:"Search Assignments"}),e.jsx(V,{id:"search",placeholder:"Search by cell number or PDL name",className:"w-64",value:i,onChange:l=>g(l.target.value),onKeyDown:l=>l.key==="Enter"&&m()}),e.jsx(p,{variant:"outline",onClick:m,children:"Search"})]}),e.jsxs("div",{className:"mb-4 flex items-center space-x-4",children:[e.jsx(j,{htmlFor:"gender-filter",className:"text-sm font-medium",children:"Filter by Gender"}),e.jsxs(w,{value:c,onValueChange:v,children:[e.jsx(A,{className:"w-48",children:e.jsx(P,{placeholder:"Select gender filter"})}),e.jsxs(T,{children:[e.jsx(b,{value:"all",children:"All Genders"}),e.jsx(b,{value:"male",children:"Male Only"}),e.jsx(b,{value:"female",children:"Female Only"})]})]})]}),e.jsx(Q,{columns:ce.map(l=>l.id==="actions"?{...l,cell:({row:h})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(q,{assignment:h.original,cells:x})})}:l),data:u})]})]})]})]})}export{Fe as default};
