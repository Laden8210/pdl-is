import{r as c,j as e,S as L,K,L as U}from"./app-B_O9F4tw.js";import{D as W}from"./data-table-D-_JnHnN.js";import{c as J,B as u}from"./button-BiD3r4ZK.js";import{C as Q,a as X,b as Y,c as Z}from"./card-DH5vEpEW.js";import{I as V}from"./input-Cch6FJY3.js";import{L as f}from"./label-CZmbwHrp.js";import{S as w,a as A,b as P,c as T,d as b}from"./select-BA3BSQrm.js";import{D as $,i as R,a as z,b as H,c as B,x as D,d as ee,A as se}from"./app-layout-Be9EpAUR.js";import{T as le}from"./textarea-dmpnxrHE.js";import{C as te}from"./checkbox-B2GzbEB3.js";import{A as M,b as G,a as E}from"./alert-rMAx_BHs.js";import"./table-D4KjtlNv.js";import"./index-D-eL34-K.js";import"./index-D5DTq6I9.js";import"./index-ByUPiVeH.js";import"./index-B3ch-uBW.js";import"./index-BCyguBGw.js";import"./users-DIrrmxra.js";import"./user-Dmxs8yN8.js";import"./scale-D2Wxh09W.js";import"./eye-CcSNQFx3.js";import"./index-Iuoe4-tW.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],ae=J("ArrowRightLeft",re);function q({assignment:r,cells:d=[]}){const[_,x]=c.useState(!1),[a,C]=c.useState(""),[n,g]=c.useState(""),[i,v]=c.useState(!1),[o,j]=c.useState({}),m=d.filter(l=>l.cell_id!==r.cell_id&&l.gender.toLowerCase()===r.cell_gender.toLowerCase()),N=async()=>{if(!a){D.error("Please select a destination cell");return}v(!0),j({});try{L.post("/pdl-management/cell-assignment/transfer",{assignment_id:r.assignment_id,to_cell_id:a,reason:n},{onSuccess:()=>{x(!1),C(""),g(""),j({}),D.success("PDL transferred successfully")},onError:l=>{if(v(!1),l&&typeof l=="object"){j(l);const h=Object.values(l)[0];h&&D.error(h)}else D.error("Failed to transfer PDL")}})}catch(l){v(!1),console.error("Transfer error:",l),D.error("An unexpected error occurred during transfer")}},S=l=>{l||(C(""),g(""),j({})),x(l)},y=d.find(l=>l.cell_id.toString()===a);return e.jsxs($,{open:_,onOpenChange:S,children:[e.jsx(R,{asChild:!0,children:e.jsxs(u,{variant:"outline",size:"sm",children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Transfer"]})}),e.jsxs(z,{className:"sm:max-w-md",children:[e.jsx(H,{children:e.jsx(B,{children:"Transfer PDL to Another Cell"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(f,{className:"text-sm font-medium",children:"PDL"}),e.jsx("p",{className:"text-sm text-gray-600",children:r.pdl_name})]}),e.jsxs("div",{children:[e.jsx(f,{className:"text-sm font-medium",children:"Current Cell"}),e.jsx("p",{className:"text-sm text-gray-600",children:r.cell_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"destination-cell",children:"Destination Cell"}),e.jsxs(w,{value:a,onValueChange:C,children:[e.jsx(A,{children:e.jsx(P,{placeholder:"Select destination cell"})}),e.jsx(T,{children:m.map(l=>e.jsxs(b,{value:l.cell_id.toString(),children:[l.cell_name," (",l.gender,") - Capacity: ",l.capacity]},l.cell_id))})]}),m.length===0&&e.jsx("p",{className:"text-sm text-red-600",children:"No available cells with matching gender"}),y&&y.gender.toLowerCase()!==r.cell_gender.toLowerCase()&&e.jsxs("p",{className:"text-sm text-yellow-600",children:["Warning: Selected cell gender (",y.gender,") doesn't match PDL gender (",r.cell_gender,")"]}),o.to_cell_id&&e.jsx("p",{className:"text-sm text-red-600",children:o.to_cell_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"reason",children:"Transfer Reason (Optional)"}),e.jsx(le,{id:"reason",placeholder:"Enter reason for transfer...",value:n,onChange:l=>g(l.target.value),rows:3}),o.reason&&e.jsx("p",{className:"text-sm text-red-600",children:o.reason})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(u,{variant:"outline",onClick:()=>x(!1),disabled:i,children:"Cancel"}),e.jsx(u,{onClick:N,disabled:!a||i||m.length===0,children:i?"Transferring...":"Transfer PDL"})]})]})]})]})}const ne=[{accessorKey:"assignment_id",header:"Assignment ID"},{accessorKey:"cell_number",header:"Cell Number"},{accessorKey:"cell_id",header:"Cell ID"},{accessorKey:"pdl_id",header:"PDL ID"},{accessorKey:"pdl_name",header:"PDL Name"},{accessorKey:"assigned_date",header:"Assigned Date",cell:({row:r})=>new Date(r.original.assigned_date).toLocaleDateString()},{id:"actions",header:"Actions",cell:({row:r})=>{const d=r.original;return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(q,{assignment:d})})}}];function ie({cells:r,pdls:d}){const[_,x]=c.useState(!1),[a,C]=c.useState(""),[n,g]=c.useState([]),[i,v]=c.useState(""),[o,j]=c.useState("all"),m=c.useMemo(()=>{let s=d;if(i&&(s=s.filter(t=>`${t.fname} ${t.lname}`.toLowerCase().includes(i.toLowerCase())||t.id.toString().includes(i))),a){const t=r.find(p=>p.cell_id.toString()===a);t&&(s=s.filter(p=>{var I;return((I=p.gender)==null?void 0:I.toLowerCase())===t.gender}))}return s},[d,i,a,r]),N=c.useMemo(()=>{let s=r;return o!=="all"&&(s=s.filter(t=>t.gender===o)),s},[r,o]),S=s=>{C(s),g([])},y=()=>{!a||n.length===0||L.post(route("cell-assignments.store"),{cell_id:a,pdl_ids:n},{onSuccess:()=>{x(!1),C(""),g([]),v(""),j("all")}})},l=s=>{g(t=>t.includes(s)?t.filter(p=>p!==s):[...t,s])},h=()=>{const s=m.map(t=>t.id);g(t=>s.every(p=>t.includes(p))?t.filter(p=>!s.includes(p)):[...new Set([...t,...s])])},{props:k}=K(),F=k.success,O=k.errors||{};return e.jsxs($,{open:_,onOpenChange:x,children:[e.jsx(R,{asChild:!0,children:e.jsx(u,{children:"Assign PDL to Cell"})}),e.jsxs(z,{className:"max-h-[80vh] max-w-3xl overflow-y-auto",children:[e.jsxs(H,{children:[e.jsx(B,{children:"Assign PDLs to Cell"}),e.jsx(ee,{children:"Select a cell and choose PDLs to assign to it."})]}),Object.keys(O).length>0&&e.jsx("div",{"data-alert-container":!0,className:"relative",children:e.jsxs(M,{variant:"destructive",children:[e.jsx("button",{type:"button","aria-label":"Close",onClick:s=>{const t=s.currentTarget.closest("[data-alert-container]")||void 0;t&&(t.style.display="none")},className:"absolute top-2 right-2 rounded p-1 text-lg leading-none hover:bg-muted",children:"×"}),e.jsx(G,{children:"Unable to process request"}),e.jsx(E,{children:e.jsx("ul",{className:"list-inside list-disc space-y-1",children:Object.values(O).map((s,t)=>e.jsx("li",{className:"text-sm",children:s},t))})})]})}),F&&e.jsx("div",{"data-alert-container":!0,className:"relative",ref:s=>{if(!s)return;s.style.display="";const t=s;t._timer&&clearTimeout(t._timer),t._timer=setTimeout(()=>{s.style.display="none"},3e3)},children:e.jsxs(M,{children:[e.jsx("button",{type:"button","aria-label":"Close",onClick:s=>{const t=s.currentTarget.closest("[data-alert-container]")||void 0;t&&(t.style.display="none")},className:"absolute top-2 right-2 rounded p-1 text-sm leading-none hover:bg-muted",children:"×"}),e.jsx(G,{children:"Success"}),e.jsx(E,{children:F})]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(f,{htmlFor:"gender-filter",children:"Filter by Gender"}),e.jsxs(w,{value:o,onValueChange:j,children:[e.jsx(A,{children:e.jsx(P,{placeholder:"Select gender filter"})}),e.jsxs(T,{children:[e.jsx(b,{value:"all",children:"All Genders"}),e.jsx(b,{value:"male",children:"Male Only"}),e.jsx(b,{value:"female",children:"Female Only"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(f,{htmlFor:"cell",children:"Select Cell"}),e.jsxs(w,{value:a,onValueChange:S,children:[e.jsx(A,{children:e.jsx(P,{placeholder:"Choose a cell"})}),e.jsx(T,{children:N.map(s=>e.jsxs(b,{value:s.cell_id.toString(),children:[s.cell_name," (Capacity: ",s.capacity,", Gender: ",s.gender,")"]},s.cell_id))})]})]}),a&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{htmlFor:"pdl-search",children:"Select PDLs"}),e.jsx(u,{variant:"outline",size:"sm",onClick:h,disabled:m.length===0,children:"Toggle All Filtered"})]}),e.jsx(V,{id:"pdl-search",placeholder:"Search PDLs by name or ID",value:i,onChange:s=>v(s.target.value)}),a&&e.jsxs("div",{className:"text-sm text-gray-600 bg-blue-50 p-2 rounded",children:[e.jsx("strong",{children:"Note:"})," Only PDLs matching the selected cell's gender are shown.",(()=>{const s=r.find(t=>t.cell_id.toString()===a);return s?` Showing ${s.gender} PDLs only.`:""})()]}),e.jsx("div",{className:"max-h-60 overflow-y-auto rounded-md border p-2",children:m.length>0?m.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-gray-50",children:[e.jsx(te,{id:`pdl-${s.id}`,checked:n.includes(s.id),onCheckedChange:()=>l(s.id)}),e.jsxs("label",{htmlFor:`pdl-${s.id}`,className:"text-sm leading-none font-medium peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:[s.fname," ",s.lname," (ID: ",s.id,") ",s.gender]})]},s.id)):e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:a?"No PDLs available for the selected cell gender.":i?"No PDLs match your search":"No PDLs available"})}),n.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Selected: ",n.length," PDL(s)"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(u,{onClick:y,disabled:!a||n.length===0,children:"Assign Selected"})]})]})]})}function Te(){var S,y;const{props:r}=K(),{auth:d}=r,{assignments:_,cells:x,pdls:a,filters:C}=r,[n,g]=c.useState(C.search||""),[i,v]=c.useState("all"),o=_.map(l=>({assignment_id:l.assignment_id,cell_number:l.cell.cell_name,cell_id:l.cell.cell_id,cell_gender:l.cell.gender,pdl_id:l.pdl.id,pdl_name:`${l.pdl.fname} ${l.pdl.lname}`,pdl_gender:l.pdl.gender,assigned_date:l.created_at})),j=c.useMemo(()=>{let l=o;return n&&(l=l.filter(h=>h.cell_number.toLowerCase().includes(n.toLowerCase())||h.pdl_name.toLowerCase().includes(n.toLowerCase()))),i!=="all"&&(l=l.filter(h=>h.cell_gender===i)),l},[o,n,i]),m=()=>{L.get("/admin/pdl-management/cell-assignment",{search:n})},N=[{title:"Cell Management",href:"/cell-management"},{title:"Assignments",href:"/record-officer/pdl-management/cell-assignment"}];return e.jsxs(se,{breadcrumbs:N,children:[e.jsx(U,{title:"Cell Assignment Management"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Cell Assignments"}),e.jsxs(Q,{children:[e.jsx(X,{children:e.jsx(Y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Cell Assignment List"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[((S=d==null?void 0:d.user)==null?void 0:S.position)==="admin"&&e.jsx(u,{variant:"outline",onClick:()=>L.get("/admin/pdl-management/cell-activity-log"),children:"View Activity Log"}),((y=d==null?void 0:d.user)==null?void 0:y.position)==="record-officer"&&e.jsx(u,{variant:"outline",onClick:()=>L.get("/record-officer/pdl-management/cell-activity-log"),children:"View Activity Log"}),e.jsx(ie,{cells:x,pdls:a})]})]})})}),e.jsxs(Z,{children:[e.jsxs("div",{className:"mb-4 flex items-center space-x-4",children:[e.jsx(f,{htmlFor:"search",className:"text-sm font-medium",children:"Search Assignments"}),e.jsx(V,{id:"search",placeholder:"Search by cell number or PDL name",className:"w-64",value:n,onChange:l=>g(l.target.value),onKeyDown:l=>l.key==="Enter"&&m()}),e.jsx(u,{variant:"outline",onClick:m,children:"Search"})]}),e.jsxs("div",{className:"mb-4 flex items-center space-x-4",children:[e.jsx(f,{htmlFor:"gender-filter",className:"text-sm font-medium",children:"Filter by Gender"}),e.jsxs(w,{value:i,onValueChange:v,children:[e.jsx(A,{className:"w-48",children:e.jsx(P,{placeholder:"Select gender filter"})}),e.jsxs(T,{children:[e.jsx(b,{value:"all",children:"All Genders"}),e.jsx(b,{value:"male",children:"Male Only"}),e.jsx(b,{value:"female",children:"Female Only"})]})]})]}),e.jsx(W,{columns:ne.map(l=>l.id==="actions"?{...l,cell:({row:h})=>e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(q,{assignment:h.original,cells:x})})}:l),data:j})]})]})]})]})}export{Te as default};
