import{K as I,r as T,m as K,j as e,L as q}from"./app-DkQz6UsW.js";import{C as te,a as de,b as ie,c as ce}from"./card-4y2XsVJE.js";import{T as Y,a as J,b as R,c as n,d as Q,e as t}from"./table-DtZNsI9y.js";import{A as k,b as U,a as B}from"./alert-C734wKHp.js";import{B as c}from"./button-CNuRJ92W.js";import{D as A,i as W,a as D,b as C,c as S,d as M,g as _,h as X,A as oe}from"./app-layout-J9aJ0rBd.js";import{I as Z}from"./input-DLSjUyQG.js";import{L as u}from"./label-mso4ZT2m.js";import{S as E,a as F,b as L,c as O,d as m}from"./select-Cv85nmwy.js";import{T as ee}from"./textarea-CE7UlOIH.js";import{B as H}from"./badge-O7rZTtEK.js";import{E as me}from"./eye-DwNp0Koe.js";import{C as z}from"./scale-_7j45dDE.js";import{U as xe}from"./user-t_7Ruqyi.js";import{S as he}from"./square-pen-XU2sA87f.js";import{T as je}from"./trash-2-BfbxZITI.js";import{T as ue}from"./triangle-alert-CihkkdM2.js";import{f as v}from"./format-B3rlCQGj.js";import{C as ge}from"./custody-management-DLiLo_tO.js";import{g as pe}from"./dateUtils-Iw3XMDmk.js";import"./index-C_8GOhet.js";import"./users-B7xAJ89u.js";import"./circle-alert-CGLOr6fA.js";import"./index-MRXULp3I.js";import"./index-Da190uII.js";import"./index-CHc7K45Z.js";import"./index-BcfLKrqN.js";function ye({pdl:s,records:x}){const{props:r}=I(),h=r.success,[N,g]=T.useState(null),[y,i]=T.useState(!1),[d,f]=T.useState(null),[w,j]=T.useState(!1),{data:b,setData:p,put:G,delete:l,processing:o,errors:V,reset:P}=K({type:"gcta",days:0,reason:""}),se=a=>{g(a),p({type:a.type,days:a.days,reason:a.reason}),i(!0)},ae=a=>{a.preventDefault(),N&&G(route("admin.time-allowance.update-record",N.id),{preserveScroll:!0,onSuccess:()=>{P(),i(!1),g(null)}})},re=a=>{f(a),j(!0)},le=()=>{d&&l(route("admin.time-allowance.revoke",d.id),{preserveScroll:!0,onSuccess:()=>{j(!1),f(null)}})},$=a=>a==="gcta"?e.jsx(H,{className:"bg-blue-100 text-blue-800",children:"GCTA"}):e.jsx(H,{className:"bg-green-100 text-green-800",children:"TASTM"});return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(q,{title:"Time Allowance Records"}),e.jsx(W,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"View Records"]})}),e.jsxs(D,{className:"max-h-[80vh] overflow-y-auto sm:max-w-[800px]",children:[e.jsxs(C,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Time Allowance Records for ",s.fname," ",s.lname]}),e.jsx(M,{children:"View and manage all time allowance records for this PDL."})]}),h&&e.jsxs(k,{variant:"default",className:"mb-4 border-green-200 bg-green-50 text-green-800",children:[e.jsx(U,{children:"Success"}),e.jsx(B,{children:h})]}),x.length>0?e.jsx("div",{className:"space-y-4",children:e.jsxs(Y,{children:[e.jsx(J,{children:e.jsxs(R,{children:[e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Days"}),e.jsx(n,{children:"Reason"}),e.jsx(n,{children:"Awarded By"}),e.jsx(n,{children:"Date"}),e.jsx(n,{className:"text-right",children:"Actions"})]})}),e.jsx(Q,{children:x.map(a=>e.jsxs(R,{children:[e.jsx(t,{children:$(a.type)}),e.jsxs(t,{className:"font-medium",children:[a.days," days"]}),e.jsx(t,{className:"max-w-xs truncate",children:a.reason}),e.jsx(t,{children:a.awardedBy?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm",children:[a.awardedBy.fname," ",a.awardedBy.lname]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Unknown"})}),e.jsx(t,{children:v(new Date(a.awarded_at),"MMM dd, yyyy")}),e.jsx(t,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>se(a),className:"h-8 w-8 p-0",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>re(a),className:"h-8 w-8 p-0 text-red-600 hover:bg-red-50 hover:text-red-700",children:e.jsx(je,{className:"h-4 w-4"})})]})})]},a.id))})]})}):e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx(z,{className:"mx-auto mb-4 h-12 w-12 text-gray-300"}),e.jsx("p",{children:"No time allowance records found for this PDL."})]}),e.jsx(_,{children:e.jsx(X,{asChild:!0,children:e.jsx(c,{variant:"secondary",children:"Close"})})})]})]}),e.jsx(A,{open:y,onOpenChange:i,children:e.jsx(D,{className:"sm:max-w-[500px]",children:e.jsxs("form",{id:"edit-time-allowance-form",onSubmit:ae,children:[e.jsxs(C,{children:[e.jsx(S,{children:"Edit Time Allowance Record"}),e.jsx(M,{children:"Update the details for this time allowance record."})]}),Object.keys(V).length>0&&e.jsxs(k,{variant:"destructive",className:"mt-4 mb-4",children:[e.jsx(U,{children:"Unable to process request"}),e.jsx(B,{children:Object.values(V).map((a,ne)=>e.jsx("ul",{className:"list-inside list-disc text-sm",children:e.jsx("li",{children:String(a)})},ne))})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"edit-type",children:"Allowance Type"}),e.jsxs(E,{value:b.type,onValueChange:a=>p("type",a),required:!0,children:[e.jsx(F,{children:e.jsx(L,{placeholder:"Select allowance type"})}),e.jsxs(O,{children:[e.jsx(m,{value:"gcta",children:"Good Conduct Time Allowance (GCTA)"}),e.jsx(m,{value:"tastm",children:"Time Allowance for Study, Teaching & Mentoring (TASTM)"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"edit-days",children:"Days"}),e.jsx(Z,{id:"edit-days",name:"days",type:"number",min:"0",value:b.days,onChange:a=>p("days",parseInt(a.target.value)||0),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"edit-reason",children:"Reason"}),e.jsx(ee,{id:"edit-reason",name:"reason",value:b.reason,onChange:a=>p("reason",a.target.value),placeholder:"Enter the reason for this time allowance",required:!0})]})]}),e.jsxs(_,{children:[e.jsx(c,{type:"button",variant:"secondary",onClick:()=>{i(!1),g(null),P()},children:"Cancel"}),e.jsx(c,{type:"submit",form:"edit-time-allowance-form",className:"bg-blue-500 hover:bg-blue-600",disabled:o,children:o?"Updating...":"Update Record"})]})]})})}),e.jsx(A,{open:w,onOpenChange:j,children:e.jsxs(D,{className:"sm:max-w-[400px]",children:[e.jsxs(C,{children:[e.jsxs(S,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(ue,{className:"h-5 w-5"}),"Confirm Deletion"]}),e.jsx(M,{children:"Are you sure you want to revoke this time allowance record? This action cannot be undone."})]}),d&&e.jsxs("div",{className:"rounded-md border bg-gray-50 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[$(d.type),e.jsxs("span",{className:"font-medium",children:[d.days," days"]})]}),e.jsxs("p",{className:"mb-1 text-sm text-gray-600",children:[e.jsx("strong",{children:"Reason:"})," ",d.reason]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Date:"})," ",v(new Date(d.awarded_at),"MMM dd, yyyy")]})]}),e.jsxs(_,{children:[e.jsx(c,{variant:"secondary",onClick:()=>{j(!1),f(null)},children:"Cancel"}),e.jsx(c,{variant:"destructive",onClick:le,disabled:o,children:o?"Revoking...":"Revoke Record"})]})]})})]})}function fe({pdl:s,gctaDays:x,tastmDays:r,records:h}){const{props:N}=I(),g=N.success,y=()=>{const l=typeof(s==null?void 0:s.years_served)=="object"?s.years_served.years:(s==null?void 0:s.years_served)||0;return l>=0&&l<=2?20:l>=3&&l<=5?23:l>=6&&l<=10?25:l>=11?30:20},{data:i,setData:d,post:f,processing:w,errors:j,reset:b}=K({type:"gcta",days:y(),reason:"",supporting_document:null}),p=l=>{l.preventDefault(),f(route("admin.time-allowance.update",s.id),{preserveScroll:!0,onSuccess:()=>{b()}})},G=l=>{d("type",l),l==="gcta"?d("days",y()):d("days",15)};return e.jsxs(A,{children:[e.jsx(q,{title:"Manage Time Allowance"}),e.jsx(W,{asChild:!0,children:e.jsx(c,{variant:"outline",children:"Manage Allowance"})}),e.jsx(D,{className:"sm:max-w-[500px]",children:e.jsxs("form",{id:"time-allowance-form",onSubmit:p,children:[e.jsxs(C,{children:[e.jsxs(S,{children:["Manage Time Allowance for ",s.fname," ",s.lname]}),e.jsx(M,{children:"Add time allowance days for Good Conduct Time Allowance (GCTA) or Time Allowance for Study, Teaching and Mentoring (TASTM)."})]}),Object.keys(j).length>0&&e.jsxs(k,{variant:"destructive",className:"mt-4 mb-4",children:[e.jsx(U,{children:"Unable to process request"}),e.jsx(B,{children:Object.values(j).map((l,o)=>e.jsx("ul",{className:"list-inside list-disc text-sm",children:e.jsx("li",{children:l})},o))})]}),g&&e.jsxs(k,{variant:"default",className:"mb-4 border-green-200 bg-green-50 text-green-800",children:[e.jsx(U,{children:"Success"}),e.jsx(B,{children:g})]}),e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-4 py-2",children:[e.jsxs("div",{className:"rounded-md border border-blue-200 bg-blue-50 p-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Current GCTA Days"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:x})]}),e.jsxs("div",{className:"rounded-md border border-green-200 bg-green-50 p-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:"Current TASTM Days"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:r})]})]}),e.jsxs("div",{className:"mb-4 rounded-md border border-gray-200 bg-gray-50 p-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"Years Served"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:typeof(s==null?void 0:s.years_served)=="object"?s.years_served.formatted:`${(s==null?void 0:s.years_served)||0} years`}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"GCTA Default:"})," ",y()," days per month (based on"," ",typeof(s==null?void 0:s.years_served)=="object"?s.years_served.years:(s==null?void 0:s.years_served)||0," years served)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TASTM Default:"})," 15 days per month (fixed)"]})]})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"type",children:"Allowance Type"}),e.jsxs(E,{value:i.type,onValueChange:G,required:!0,children:[e.jsx(F,{children:e.jsx(L,{placeholder:"Select allowance type"})}),e.jsxs(O,{children:[e.jsx(m,{value:"gcta",children:"Good Conduct Time Allowance (GCTA)"}),e.jsx(m,{value:"tastm",children:"Time Allowance for Study, Teaching & Mentoring (TASTM)"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"days",children:"Days to Add"}),e.jsxs(E,{value:i.days.toString(),onValueChange:l=>d("days",parseInt(l)),required:!0,children:[e.jsx(F,{children:e.jsx(L,{placeholder:"Select days to add"})}),e.jsx(O,{children:i.type==="gcta"?e.jsxs(e.Fragment,{children:[e.jsx(m,{value:"20",children:"20 days (0-2 years served)"}),e.jsx(m,{value:"23",children:"23 days (3-5 years served)"}),e.jsx(m,{value:"25",children:"25 days (6-10 years served)"}),e.jsx(m,{value:"30",children:"30 days (11+ years served)"})]}):e.jsx(m,{value:"15",children:"15 days (TASTM fixed)"})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(u,{htmlFor:"reason",children:"Reason"}),e.jsx(ee,{id:"reason",name:"reason",value:i.reason,onChange:l=>d("reason",l.target.value),placeholder:"Enter the reason for adding time allowance",required:!0})]}),e.jsxs("div",{className:"grid gap-2 mb-2",children:[e.jsx(u,{htmlFor:"supporting_document",children:"Supporting Document (optional)"}),e.jsx("div",{children:e.jsx("div",{className:"mb-1 text-xs text-gray-600",children:"Upload a supporting document (e.g., approval letter, memorandum) if applicable."})}),e.jsxs("div",{children:[e.jsx(Z,{type:"file",id:"supporting_document",name:"supporting_document",accept:".jpg,.jpeg,.png",onChange:l=>{var o;return d("supporting_document",((o=l.target.files)==null?void 0:o[0])||null)}}),i.supporting_document&&e.jsx("a",{href:URL.createObjectURL(i.supporting_document),target:"_blank",rel:"noopener noreferrer",className:"mt-2 inline-block text-sm text-blue-600 hover:underline",children:"Review Uploaded Document"})]})]})]}),e.jsx(_,{children:e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(X,{asChild:!0,children:e.jsx(c,{variant:"secondary",children:"Cancel"})}),e.jsx(ye,{pdl:s,records:h}),e.jsx(c,{type:"submit",form:"time-allowance-form",className:"bg-blue-500 hover:bg-blue-600",disabled:w,children:w?"Adding...":"Add Allowance"})]})})})]})})]})}const be=[{title:"PDL Management",href:"/pdl-management"}];function Ye(){const{props:s}=I(),{verifications:x}=s;return console.log("Verifications:",x),e.jsxs(oe,{breadcrumbs:be,children:[e.jsx(q,{title:"Personal Information"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Time Allowance Management"}),e.jsxs(te,{children:[e.jsx(de,{children:e.jsx(ie,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("span",{children:"Time Allowance List"})})})}),e.jsx(ce,{children:e.jsxs(Y,{children:[e.jsx(J,{children:e.jsxs(R,{children:[e.jsx(n,{children:"ID"}),e.jsx(n,{children:"Full Name"}),e.jsx(n,{children:"Alias"}),e.jsx(n,{children:"Gender"}),e.jsx(n,{children:"GCTA Days"}),e.jsx(n,{children:"TASTM Days"}),e.jsx(n,{children:"Admission Date"}),e.jsx(n,{children:"Release Date"}),e.jsx(n,{children:"Date of Birth"}),e.jsx(n,{children:"Age"}),e.jsx(n,{children:"Added By"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(Q,{children:x.map(r=>{var h;return r.pdl&&e.jsxs(R,{children:[e.jsx(t,{children:r.pdl.id}),e.jsx(t,{children:`${r.pdl.fname} ${r.pdl.lname}`}),e.jsx(t,{children:r.pdl.alias??"-"}),e.jsx(t,{children:r.pdl.gender??"-"}),e.jsx(t,{className:"font-medium",children:r.gcta_days}),e.jsx(t,{className:"font-medium",children:r.tastm_days}),e.jsx(t,{children:r.pdl.admission_date?v(new Date(r.pdl.admission_date),"MMM dd, yyyy"):"—"}),e.jsx(t,{children:r.pdl.release_date?v(new Date(r.pdl.release_date),"MMM dd, yyyy"):"—"}),e.jsx(t,{children:v(new Date(r.pdl.birthdate),"MMMM dd, yyyy")}),e.jsx(t,{children:pe(r.pdl.birthdate)}),e.jsx(t,{children:r.pdl.personnel?`${r.pdl.personnel.fname} ${r.pdl.personnel.lname}`:"—"}),e.jsxs(t,{className:"space-x-1 flex items-center gap-2",children:[e.jsx(fe,{pdl:r.pdl,gctaDays:r.gcta_days,tastmDays:r.tastm_days,records:((h=r.pdl)==null?void 0:h.time_allowance_records)||[]}),e.jsx(ge,{pdl:r.pdl})]})]},r.pdl.id)})})]})})]})]})]})}export{Ye as default};
