import{r as l,m as U,K as H,b as G,j as e,L as q,$ as K}from"./app-DnCCZdQP.js";import{D as J,i as Q,a as W,b as X,c as Y,d as Z,P as ee,e as se,f as re,g as ae,A as te,j as ne}from"./app-layout-DFlDjcO4.js";import{C as ie,a as oe,b as ce,c as le}from"./card-C9X8j58u.js";import{T as me,a as de,b as z,c as n,d as he,e as i}from"./table-B7vGkIzC.js";import{B as g}from"./button-Bzh5YXD2.js";import{A as M,b as E,a as R}from"./alert-BdGcwtQT.js";import{L as xe}from"./label-hjpTsbbL.js";import{C as ue,a as fe,b as je,c as ge,d as pe,e as ve,f as Ce}from"./command-BwlvaZ2K.js";import{C as Ne}from"./index-andYFLom.js";import{V as be}from"./view-pdl-information-hbQUP8RY.js";import{I as we}from"./input-CMVIeUot.js";import{S as ye,a as Le,b as Se,c as Pe,d as A,C as Te}from"./select-B7ubXH-Y.js";import{S as De}from"./users-BLuOJmIv.js";import{f as ke}from"./format-B3rlCQGj.js";import"./index-BUKMWMlH.js";import"./user-DPLirZ3g.js";import"./scale-kSXqTHaD.js";import"./eye-DtGDJvfS.js";import"./circle-alert-tHfdt3Eq.js";import"./index-Bwy5C-G7.js";import"./index-BBKAsmee.js";import"./index-CmBb7qlo.js";import"./accordion-Dx_PTUh4.js";import"./badge-DVQEiFH_.js";import"./square-pen-C_oMok4a.js";import"./textarea-B-_ww_NI.js";import"./radio-group-Ba9Lmhi0.js";import"./plus-xpe-MNMy.js";import"./custody-management-uTn32Sb6.js";function $e({pdl:b}){const[C,p]=l.useState(!1),[D,u]=l.useState(!1),[_,v]=l.useState([]),[k,m]=l.useState(!1),{data:c,setData:j,post:I,processing:f,errors:d,reset:N}=U({reason:"",pdl_id:b.id}),{props:$}=H(),h=$.success,x=$.error;l.useEffect(()=>{C&&s()},[C]);const s=async()=>{m(!0);try{const a=await G.get(route("pdl-management.transfer-reasons"));v(a.data)}catch(a){console.error("Failed to fetch transfer reasons:",a)}finally{m(!1)}},r=()=>{I(route("pdl-management.transfer",b.id),{preserveScroll:!0,onSuccess:()=>{N(),s(),setTimeout(()=>p(!1),2e3)}})};return e.jsxs(J,{open:C,onOpenChange:p,children:[e.jsx(Q,{asChild:!0,children:e.jsx(g,{variant:"ghost",children:"Transfer PDL"})}),e.jsxs(W,{className:"sm:max-w-md",children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Confirm PDL Transfer"}),e.jsxs(Z,{children:["Transfer ",b.full_name," to another facility"]})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[h&&e.jsxs(M,{variant:"success",className:"mb-4",children:[e.jsx(E,{children:"Success"}),e.jsx(R,{children:h})]}),x&&e.jsxs(M,{variant:"destructive",children:[e.jsx(E,{children:"Error"}),e.jsx(R,{children:x})]}),Object.keys(d).length>0&&e.jsxs(M,{variant:"destructive",children:[e.jsx(E,{children:"Error"}),e.jsx(R,{children:e.jsx("ul",{className:"list-inside list-disc",children:Object.values(d).map((a,t)=>e.jsx("li",{children:a},t))})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(xe,{htmlFor:"reason",children:"Transfer Reason *"}),e.jsxs(ee,{open:D,onOpenChange:u,children:[e.jsx(se,{asChild:!0,children:e.jsxs(g,{variant:"outline",role:"combobox","aria-expanded":D,className:"w-full justify-between",children:[c.reason||"Select or type transfer reason...",e.jsx(ue,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(re,{className:"w-full p-0",align:"start",children:e.jsxs(fe,{children:[e.jsx(je,{placeholder:"Search reasons or type custom...",value:c.reason,onValueChange:a=>j("reason",a)}),e.jsxs(ge,{children:[e.jsx(pe,{children:e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"No reason found. Type your custom reason and press Enter to use it."})}),e.jsx(ve,{children:k?e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"Loading reasons..."}):_.map(a=>e.jsxs(Ce,{value:a,onSelect:t=>{j("reason",t),u(!1)},children:[e.jsx(Ne,{className:`mr-2 h-4 w-4 ${c.reason===a?"opacity-100":"opacity-0"}`}),a]},a))})]})]})})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Select from common reasons or type a custom transfer reason. Custom reasons will be saved for future use."})]}),e.jsx("div",{className:"mt-2 rounded bg-yellow-50 p-4",children:e.jsxs("p",{className:"text-sm text-yellow-700",children:[e.jsx("span",{className:"font-bold",children:"Final Confirmation:"})," This action will immediately initiate the transfer process. Are you sure you want to transfer this PDL?"]})})]}),e.jsxs(ae,{children:[e.jsx(g,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(g,{type:"button",onClick:r,disabled:f||!c.reason.trim(),className:"bg-red-600 hover:bg-red-700 disabled:opacity-50",children:f?"Processing...":"Confirm Transfer"})]})]})]})}const Ae=[{title:"PDL Management",href:"/pdl-management"}];function cs(){const{props:b}=H(),{pdls:C}=b,[p,D]=l.useState(""),[u,_]=l.useState("name"),[v,k]=l.useState("asc"),[m,c]=l.useState(1),[j,I]=l.useState(10),f=l.useMemo(()=>{let s=C.filter(r=>{var o,w,y,L,S,P,T;const a=`${(r==null?void 0:r.fname)||""} ${(r==null?void 0:r.mname)||""} ${(r==null?void 0:r.lname)||""}`.toLowerCase(),t=p.toLowerCase();return a.includes(t)||((o=r.alias)==null?void 0:o.toLowerCase().includes(t))||((w=r.gender)==null?void 0:w.toLowerCase().includes(t))||((y=r.ethnic_group)==null?void 0:y.toLowerCase().includes(t))||((L=r.civil_status)==null?void 0:L.toLowerCase().includes(t))||((S=r.brgy)==null?void 0:S.toLowerCase().includes(t))||((P=r.city)==null?void 0:P.toLowerCase().includes(t))||((T=r.province)==null?void 0:T.toLowerCase().includes(t))||r.id.toString().includes(t)});return s.sort((r,a)=>{var w,y,L,S,P,T,O,V,F,B;let t,o;switch(u){case"name":t=`${r.fname} ${r.mname} ${r.lname}`.toLowerCase(),o=`${a.fname} ${a.mname} ${a.lname}`.toLowerCase();break;case"id":t=r.id,o=a.id;break;case"gender":t=((w=r.gender)==null?void 0:w.toLowerCase())||"",o=((y=a.gender)==null?void 0:y.toLowerCase())||"";break;case"ethnic_group":t=((L=r.ethnic_group)==null?void 0:L.toLowerCase())||"",o=((S=a.ethnic_group)==null?void 0:S.toLowerCase())||"";break;case"civil_status":t=((P=r.civil_status)==null?void 0:P.toLowerCase())||"",o=((T=a.civil_status)==null?void 0:T.toLowerCase())||"";break;case"age":t=r.age,o=a.age;break;case"agency":t=((V=(O=r.personnel)==null?void 0:O.agency)==null?void 0:V.toLowerCase())||"",o=((B=(F=a.personnel)==null?void 0:F.agency)==null?void 0:B.toLowerCase())||"";break;default:t=r[u],o=a[u]}return t<o?v==="asc"?-1:1:t>o?v==="asc"?1:-1:0}),s},[C,p,u,v]),d=Math.ceil(f.length/j),N=(m-1)*j,$=f.slice(N,N+j),h=s=>{u===s?k(v==="asc"?"desc":"asc"):(_(s),k("asc")),c(1)},x=({field:s})=>u!==s?null:v==="asc"?e.jsx(Te,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4"});return e.jsxs(te,{breadcrumbs:Ae,children:[e.jsx(q,{title:"Personal Information"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Personal Information"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-start sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(De,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(we,{placeholder:"Search PDLs...",value:p,onChange:s=>{D(s.target.value),c(1)},className:"pl-8"})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Show:"}),e.jsxs(ye,{value:j.toString(),onValueChange:s=>{I(Number(s)),c(1)},children:[e.jsx(Le,{className:"w-20",children:e.jsx(Se,{})}),e.jsxs(Pe,{children:[e.jsx(A,{value:"10",children:"10"}),e.jsx(A,{value:"25",children:"25"}),e.jsx(A,{value:"50",children:"50"}),e.jsx(A,{value:"100",children:"100"})]})]})]}),e.jsx(K,{href:"/pdl-management/personal-information/create",className:"flex items-center gap-2 rounded-sm bg-blue-500 px-4 py-2 text-sm text-white hover:bg-blue-600",children:"Add PDL Information"})]})]}),e.jsxs(ie,{children:[e.jsx(oe,{children:e.jsxs(ce,{children:["Personal Information List",e.jsxs("span",{className:"text-sm font-normal text-muted-foreground ml-2",children:["(",f.length," PDL",f.length!==1?"s":"",")"]})]})}),e.jsxs(le,{children:[e.jsxs(me,{children:[e.jsx(de,{children:e.jsxs(z,{children:[e.jsx(n,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>h("id"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["ID",e.jsx(x,{field:"id"})]})}),e.jsx(n,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>h("name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Full Name",e.jsx(x,{field:"name"})]})}),e.jsx(n,{children:"Alias"}),e.jsx(n,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>h("gender"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Gender",e.jsx(x,{field:"gender"})]})}),e.jsx(n,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>h("ethnic_group"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Ethnic Group",e.jsx(x,{field:"ethnic_group"})]})}),e.jsx(n,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>h("civil_status"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Civil Status",e.jsx(x,{field:"civil_status"})]})}),e.jsx(n,{children:"Date of Birth"}),e.jsx(n,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>h("age"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Age",e.jsx(x,{field:"age"})]})}),e.jsx(n,{children:"Address"}),e.jsx(n,{children:"Encoded By"}),e.jsx(n,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>h("agency"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Agency",e.jsx(x,{field:"agency"})]})}),e.jsx(n,{children:"Transfer Request"}),e.jsx(n,{children:"Archive Status"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(he,{children:$.map(s=>e.jsxs(z,{children:[e.jsx(i,{children:s.id}),e.jsx(i,{children:`${(s==null?void 0:s.fname)||""}  ${s==null?void 0:s.mname} ${(s==null?void 0:s.lname)||""}`.trim().split(" ").filter(Boolean).map(r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()).join(" ")}),e.jsx(i,{children:s.alias??"-"}),e.jsx(i,{children:s.gender??"-"}),e.jsx(i,{children:s.ethnic_group??"-"}),e.jsx(i,{children:s.civil_status??"-"}),e.jsx(i,{children:ke(new Date(s.birthdate),"MMMM dd, yyyy")}),e.jsx(i,{children:s.age}),e.jsx(i,{children:`${s.brgy??""}, ${s.city??""}, ${s.province??""}`}),e.jsx(i,{children:s.personnel?`${s.personnel.fname} ${s.personnel.lname}`:"—"}),e.jsx(i,{children:s.personnel?`${s.personnel.agency}`:"—"}),e.jsx(i,{children:s.verifications.length>0?s.verifications[0].status.charAt(0).toUpperCase()+s.verifications[0].status.slice(1):"No Verification"}),e.jsx(i,{children:s.archived_at?e.jsx("span",{className:"inline-flex items-center rounded-full bg-red-100 px-2 py-1 text-xs font-medium text-red-800",children:"Archived"}):e.jsx("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2 py-1 text-xs font-medium text-green-800",children:"Active"})}),e.jsx(i,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(be,{pdl:s}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>{window.location.href=`/law-enforcement/pdl-management/personal-information/${s.id}`},children:"Edit"}),e.jsx($e,{pdl:s})]})})]},s.id))})]}),d>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",N+1," to ",Math.min(N+j,f.length)," of ",f.length," entries"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>c(s=>Math.max(s-1,1)),disabled:m===1,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,d)},(s,r)=>{let a;return d<=5||m<=3?a=r+1:m>=d-2?a=d-4+r:a=m-2+r,e.jsx(g,{variant:m===a?"default":"outline",size:"sm",onClick:()=>c(a),children:a},a)})}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>c(s=>Math.min(s+1,d)),disabled:m===d,children:"Next"})]})]})]})]})]})]})}export{cs as default};
