import{K as P,r as B,m as q,j as e,L as U}from"./app-nRThr21f.js";import{C as ae,a as te,b as re,c as ne}from"./card-BtWu22vt.js";import{T as J,a as Q,b as E,c as i,d as W,e as c}from"./table-DIzpBcrz.js";import{A as b,b as N,a as v}from"./alert-lfehfQfo.js";import{c as le,B as m}from"./button-PZgMubAt.js";import{D as M,e as $,a as A,b as S,c as _,d as k,f as R,g as H,A as de}from"./app-layout-Bl_GOnn5.js";import{I as F}from"./input-BqM7M9GW.js";import{L}from"./label-CQYCAmFm.js";import{S as ie,a as ce,b as oe,c as me,d as Y}from"./select-M2tkefAd.js";import{T as xe}from"./textarea-CU0tI5wG.js";import{B as z}from"./badge-DQwT16Ex.js";import{E as he}from"./eye-D3uxVDSl.js";import{C as G}from"./scale-DOUfLDit.js";import{U as je}from"./user-DyeyardW.js";import{S as ue}from"./square-pen-D81H4F0F.js";import{T as ge}from"./trash-2-137QUfkP.js";import{T as ye}from"./triangle-alert-CO6RiQln.js";import{n as pe,d as fe,f}from"./format-B3rlCQGj.js";import{g as be}from"./dateUtils-Iw3XMDmk.js";import"./index-DrcFLKrz.js";import"./users-CDqsdln6.js";import"./index-DzeHGQVg.js";import"./index-B02CZ93c.js";import"./index-BAztvFaU.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],ve=le("CalendarDays",Ne);function we(s,d,a){const[l,h]=pe(a==null?void 0:a.in,s,d),x=K(l,h),u=Math.abs(fe(l,h));l.setDate(l.getDate()-x*u);const j=+(K(l,h)===-x),o=x*(u-j);return o===0?0:o}function K(s,d){const a=s.getFullYear()-d.getFullYear()||s.getMonth()-d.getMonth()||s.getDate()-d.getDate()||s.getHours()-d.getHours()||s.getMinutes()-d.getMinutes()||s.getSeconds()-d.getSeconds()||s.getMilliseconds()-d.getMilliseconds();return a<0?-1:a>0?1:a}function De({pdl:s,records:d}){const{props:a}=P(),l=a.success,[h,x]=B.useState(null),[u,j]=B.useState(!1),[o,y]=B.useState(null),[I,r]=B.useState(!1),{data:g,setData:n,put:w,delete:D,processing:p,errors:T,reset:C}=q({type:"gcta",days:0,reason:""}),O=t=>{x(t),n({type:t.type,days:t.days,reason:t.reason}),j(!0)},X=t=>{t.preventDefault(),h&&w(route("admin.time-allowance.update-record",h.id),{preserveScroll:!0,onSuccess:()=>{C(),j(!1),x(null)}})},Z=t=>{y(t),r(!0)},ee=()=>{o&&D(route("admin.time-allowance.revoke",o.id),{preserveScroll:!0,onSuccess:()=>{r(!1),y(null)}})},V=t=>t==="gcta"?e.jsx(z,{className:"bg-blue-100 text-blue-800",children:"GCTA"}):e.jsx(z,{className:"bg-green-100 text-green-800",children:"TASTM"});return e.jsxs(e.Fragment,{children:[e.jsxs(M,{children:[e.jsx(U,{title:"Time Allowance Records"}),e.jsx($,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"View Records"]})}),e.jsxs(A,{className:"sm:max-w-[800px] max-h-[80vh] overflow-y-auto",children:[e.jsxs(S,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Time Allowance Records for ",s.fname," ",s.lname]}),e.jsx(k,{children:"View and manage all time allowance records for this PDL."})]}),l&&e.jsxs(b,{variant:"default",className:"mb-4 border-green-200 bg-green-50 text-green-800",children:[e.jsx(N,{children:"Success"}),e.jsx(v,{children:l})]}),d.length>0?e.jsx("div",{className:"space-y-4",children:e.jsxs(J,{children:[e.jsx(Q,{children:e.jsxs(E,{children:[e.jsx(i,{children:"Type"}),e.jsx(i,{children:"Days"}),e.jsx(i,{children:"Reason"}),e.jsx(i,{children:"Awarded By"}),e.jsx(i,{children:"Date"}),e.jsx(i,{className:"text-right",children:"Actions"})]})}),e.jsx(W,{children:d.map(t=>e.jsxs(E,{children:[e.jsx(c,{children:V(t.type)}),e.jsxs(c,{className:"font-medium",children:[t.days," days"]}),e.jsx(c,{className:"max-w-xs truncate",children:t.reason}),e.jsx(c,{children:t.awardedBy?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm",children:[t.awardedBy.fname," ",t.awardedBy.lname]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Unknown"})}),e.jsx(c,{children:f(new Date(t.awarded_at),"MMM dd, yyyy")}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>O(t),className:"h-8 w-8 p-0",children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>Z(t),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(ge,{className:"h-4 w-4"})})]})})]},t.id))})]})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No time allowance records found for this PDL."})]}),e.jsx(R,{children:e.jsx(H,{asChild:!0,children:e.jsx(m,{variant:"secondary",children:"Close"})})})]})]}),e.jsx(M,{open:u,onOpenChange:j,children:e.jsx(A,{className:"sm:max-w-[500px]",children:e.jsxs("form",{id:"edit-time-allowance-form",onSubmit:X,children:[e.jsxs(S,{children:[e.jsx(_,{children:"Edit Time Allowance Record"}),e.jsx(k,{children:"Update the details for this time allowance record."})]}),Object.keys(T).length>0&&e.jsxs(b,{variant:"destructive",className:"mb-4 mt-4",children:[e.jsx(N,{children:"Unable to process request"}),e.jsx(v,{children:Object.values(T).map((t,se)=>e.jsx("ul",{className:"list-inside list-disc text-sm",children:e.jsx("li",{children:String(t)})},se))})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"edit-type",children:"Allowance Type"}),e.jsxs(ie,{value:g.type,onValueChange:t=>n("type",t),required:!0,children:[e.jsx(ce,{children:e.jsx(oe,{placeholder:"Select allowance type"})}),e.jsxs(me,{children:[e.jsx(Y,{value:"gcta",children:"Good Conduct Time Allowance (GCTA)"}),e.jsx(Y,{value:"tastm",children:"Time Allowance for Study, Teaching & Mentoring (TASTM)"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"edit-days",children:"Days"}),e.jsx(F,{id:"edit-days",name:"days",type:"number",min:"0",value:g.days,onChange:t=>n("days",parseInt(t.target.value)||0),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"edit-reason",children:"Reason"}),e.jsx(xe,{id:"edit-reason",name:"reason",value:g.reason,onChange:t=>n("reason",t.target.value),placeholder:"Enter the reason for this time allowance",required:!0})]})]}),e.jsxs(R,{children:[e.jsx(m,{type:"button",variant:"secondary",onClick:()=>{j(!1),x(null),C()},children:"Cancel"}),e.jsx(m,{type:"submit",form:"edit-time-allowance-form",className:"bg-blue-500 hover:bg-blue-600",disabled:p,children:p?"Updating...":"Update Record"})]})]})})}),e.jsx(M,{open:I,onOpenChange:r,children:e.jsxs(A,{className:"sm:max-w-[400px]",children:[e.jsxs(S,{children:[e.jsxs(_,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(ye,{className:"h-5 w-5"}),"Confirm Deletion"]}),e.jsx(k,{children:"Are you sure you want to revoke this time allowance record? This action cannot be undone."})]}),o&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[V(o.type),e.jsxs("span",{className:"font-medium",children:[o.days," days"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:[e.jsx("strong",{children:"Reason:"})," ",o.reason]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Date:"})," ",f(new Date(o.awarded_at),"MMM dd, yyyy")]})]}),e.jsxs(R,{children:[e.jsx(m,{variant:"secondary",onClick:()=>{r(!1),y(null)},children:"Cancel"}),e.jsx(m,{variant:"destructive",onClick:ee,disabled:p,children:p?"Revoking...":"Revoke Record"})]})]})})]})}function Te({pdl:s,gctaDays:d,tastmDays:a,records:l}){const{props:h}=P(),x=h.success,u=()=>{const r=typeof(s==null?void 0:s.years_served)=="object"?s.years_served.years:(s==null?void 0:s.years_served)||0;return r>=0&&r<=2?20:r>=3&&r<=5?23:r>=6&&r<=10?25:r>=11?30:20},{post:j,errors:o,reset:y}=q({type:"gcta",days:u(),reason:""}),I=r=>{r.preventDefault(),j(route("admin.time-allowance.update",s.id),{preserveScroll:!0,onSuccess:()=>{y()}})};return e.jsxs(M,{children:[e.jsx(U,{title:"Manage Time Allowance"}),e.jsx($,{asChild:!0,children:e.jsx(m,{variant:"outline",children:"Manage Allowance"})}),e.jsx(A,{className:"sm:max-w-[500px]",children:e.jsxs("form",{id:"time-allowance-form",onSubmit:I,children:[e.jsxs(S,{children:[e.jsxs(_,{children:["Manage Time Allowance for ",s.fname," ",s.lname]}),e.jsx(k,{children:"Add time allowance days for Good Conduct Time Allowance (GCTA) or Time Allowance for Study, Teaching and Mentoring (TASTM)."})]}),Object.keys(o).length>0&&e.jsxs(b,{variant:"destructive",className:"mb-4 mt-4",children:[e.jsx(N,{children:"Unable to process request"}),e.jsx(v,{children:Object.values(o).map((r,g)=>e.jsx("ul",{className:"list-inside list-disc text-sm",children:e.jsx("li",{children:r})},g))})]}),x&&e.jsxs(b,{variant:"default",className:"mb-4 border-green-200 bg-green-50 text-green-800",children:[e.jsx(N,{children:"Success"}),e.jsx(v,{children:x})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 py-2",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-md border border-blue-200",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Current GCTA Days"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:d})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-md border border-green-200",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:"Current TASTM Days"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:a})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-md border border-gray-200 mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"Years Served"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:typeof(s==null?void 0:s.years_served)=="object"?s.years_served.formatted:`${(s==null?void 0:s.years_served)||0} years`})]}),e.jsx("div",{className:"grid gap-4 py-2"}),e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-between w-full",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{asChild:!0,children:e.jsx(m,{variant:"secondary",children:"Cancel"})}),e.jsx(De,{pdl:s,records:l})]})})})]})})]})}function Ce({pdl:s}){const{props:d}=P(),a=d.success,{data:l,setData:h,post:x,processing:u,errors:j,reset:o}=q({admission_date:s!=null&&s.admission_date?f(new Date(s.admission_date),"yyyy-MM-dd"):"",release_date:s!=null&&s.release_date?f(new Date(s.release_date),"yyyy-MM-dd"):""}),y=n=>{n.preventDefault(),x(route("admin.custody.update",s.id),{preserveScroll:!0,onSuccess:()=>{o()}})},r=(()=>{if(!l.admission_date)return null;const n=new Date(l.admission_date),w=l.release_date?new Date(l.release_date):new Date,D=we(w,n),p=Math.floor(D/365),T=D%365,C=Math.floor(T/30),O=T%30;return{totalDays:D,years:p,months:C,days:O,formatted:`${p} years ${C} months ${O} days`,isReleased:!!l.release_date}})(),g=n=>n>=1&&n<=2?20:n>=3&&n<=5?23:n>=6&&n<=10?25:n>=11?30:0;return e.jsxs(M,{children:[e.jsx(U,{title:"Custody Management"}),e.jsx($,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Manage Custody"]})}),e.jsx(A,{className:"sm:max-w-[600px]",children:e.jsxs("form",{id:"custody-form",onSubmit:y,children:[e.jsxs(S,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Custody Management for ",s.fname," ",s.lname]}),e.jsx(k,{children:"Set admission and release dates to track custody period and calculate time allowances."})]}),Object.keys(j).length>0&&e.jsxs(b,{variant:"destructive",className:"mb-4 mt-4",children:[e.jsx(N,{children:"Unable to process request"}),e.jsx(v,{children:Object.values(j).map((n,w)=>e.jsx("ul",{className:"list-inside list-disc text-sm",children:e.jsx("li",{children:String(n)})},w))})]}),a&&e.jsxs(b,{variant:"default",className:"mb-4 border-green-200 bg-green-50 text-green-800",children:[e.jsx(N,{children:"Success"}),e.jsx(v,{children:a})]}),r&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-md border border-blue-200 mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800 mb-2",children:"Custody Period"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-blue-700",children:[e.jsx("strong",{children:"Total Days:"})," ",r.totalDays," days"]}),e.jsxs("p",{className:"text-blue-700",children:[e.jsx("strong",{children:"Period:"})," ",r.formatted]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-blue-700",children:[e.jsx("strong",{children:"Status:"})," ",r.isReleased?"Released":"Currently in custody"]}),e.jsxs("p",{className:"text-blue-700",children:[e.jsx("strong",{children:"GCTA Default:"})," ",g(r.years)," days/month"]})]})]})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"admission_date",children:"Admission Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(F,{id:"admission_date",name:"admission_date",type:"date",value:l.admission_date,onChange:n=>h("admission_date",n.target.value),className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"release_date",children:"Release Date (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(F,{id:"release_date",name:"release_date",type:"date",value:l.release_date,onChange:n=>h("release_date",n.target.value),className:"pl-10"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Leave empty if PDL is still in custody"})]})]}),r&&r.years>0&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md border border-gray-200 mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-2",children:"Time Allowance Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"GCTA Eligibility:"})," ",r.years>=1?"Yes":"No"]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Default GCTA:"})," ",g(r.years)," days/month"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"TASTM Eligibility:"})," Yes"]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Default TASTM:"})," 15 days/year"]})]})]})]}),e.jsxs(R,{children:[e.jsx(H,{asChild:!0,children:e.jsx(m,{variant:"secondary",children:"Cancel"})}),e.jsx(m,{type:"submit",form:"custody-form",className:"bg-blue-500 hover:bg-blue-600",disabled:u,children:u?"Updating...":"Update Custody Dates"})]})]})})]})}const Me=[{title:"PDL Management",href:"/pdl-management"}];function Xe(){const{props:s}=P(),{verifications:d}=s;return console.log("Verifications:",d),e.jsxs(de,{breadcrumbs:Me,children:[e.jsx(U,{title:"Personal Information"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Time Allowance Management"}),e.jsxs(ae,{children:[e.jsx(te,{children:e.jsx(re,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("span",{children:"Time Allowance List"})})})}),e.jsx(ne,{children:e.jsxs(J,{children:[e.jsx(Q,{children:e.jsxs(E,{children:[e.jsx(i,{children:"ID"}),e.jsx(i,{children:"Full Name"}),e.jsx(i,{children:"Alias"}),e.jsx(i,{children:"Gender"}),e.jsx(i,{children:"GCTA Days"}),e.jsx(i,{children:"TASTM Days"}),e.jsx(i,{children:"Admission Date"}),e.jsx(i,{children:"Release Date"}),e.jsx(i,{children:"Date of Birth"}),e.jsx(i,{children:"Age"}),e.jsx(i,{children:"Added By"}),e.jsx(i,{children:"Actions"})]})}),e.jsx(W,{children:d.map(a=>{var l;return a.pdl&&e.jsxs(E,{children:[e.jsx(c,{children:a.pdl.id}),e.jsx(c,{children:`${a.pdl.fname} ${a.pdl.lname}`}),e.jsx(c,{children:a.pdl.alias??"-"}),e.jsx(c,{children:a.pdl.gender??"-"}),e.jsx(c,{className:"font-medium",children:a.gcta_days}),e.jsx(c,{className:"font-medium",children:a.tastm_days}),e.jsx(c,{children:a.pdl.admission_date?f(new Date(a.pdl.admission_date),"MMM dd, yyyy"):"—"}),e.jsx(c,{children:a.pdl.release_date?f(new Date(a.pdl.release_date),"MMM dd, yyyy"):"—"}),e.jsx(c,{children:f(new Date(a.pdl.birthdate),"MMMM dd, yyyy")}),e.jsx(c,{children:be(a.pdl.birthdate)}),e.jsx(c,{children:a.pdl.personnel?`${a.pdl.personnel.fname} ${a.pdl.personnel.lname}`:"—"}),e.jsxs(c,{className:"space-x-1 flex items-center gap-2",children:[e.jsx(Te,{pdl:a.pdl,gctaDays:a.gcta_days,tastmDays:a.tastm_days,records:((l=a.pdl)==null?void 0:l.time_allowance_records)||[]}),e.jsx(Ce,{pdl:a.pdl})]})]},a.pdl.id)})})]})})]})]})]})}export{Xe as default};
