import{j as e,r as o,K as N,S as _,L as T}from"./app-DcCWX9mk.js";import{D as k}from"./data-table-j-gwovtj.js";import{B as d,I as A}from"./index-Cjjgm7p9.js";import{C as I,a as M,b as E,c as K}from"./card-QNSo3ZOw.js";import{L as j}from"./label-Cwa1UCo1.js";import{D as F,e as $,a as O,b as z,c as B,d as H,A as V}from"./app-layout-CwuzIVoQ.js";import{D as q,a as R,b as U,d as G,c as D}from"./dropdown-menu-CMrTdwkl.js";import{E as J}from"./ellipsis-DzfNUrwQ.js";import{C as Q}from"./checkbox-CQkbq8Ug.js";import{S as W,a as X,b as Y,c as Z,d as ee}from"./select-DZJSQo1m.js";import{A as y,a as v,b as S}from"./alert-CuSR_Jww.js";import"./table-CgMGOAID.js";import"./utils-CRZLC5Gr.js";import"./users-C5OIh5tf.js";import"./index-C1uMEMb0.js";import"./index-B9NzzXP_.js";import"./index-st6-WOiA.js";import"./index-DlSnFdn1.js";const se=[{accessorKey:"assignment_id",header:"Assignment ID"},{accessorKey:"cell_number",header:"Cell Number"},{accessorKey:"cell_id",header:"Cell ID"},{accessorKey:"pdl_id",header:"PDL ID"},{accessorKey:"pdl_name",header:"PDL Name"},{accessorKey:"assigned_date",header:"Assigned Date",cell:({row:r})=>new Date(r.original.assigned_date).toLocaleDateString()},{id:"actions",header:"Actions",cell:({row:r})=>{const n=r.original;return e.jsxs(q,{children:[e.jsx(R,{asChild:!0,children:e.jsxs(d,{variant:"ghost",size:"icon",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(J,{className:"h-4 w-4"})]})}),e.jsxs(U,{align:"end",children:[e.jsx(G,{children:"Actions"}),e.jsx(D,{onClick:()=>console.log("Edit assignment",n.assignment_id),children:"Edit"}),e.jsx(D,{onClick:()=>console.log("Delete assignment",n.assignment_id),children:"Delete"})]})]})}}];function le({cells:r,pdls:n}){const[p,m]=o.useState(!1),[c,h]=o.useState(""),[i,u]=o.useState([]),[a,g]=o.useState(""),t=o.useMemo(()=>a?n.filter(s=>`${s.fname} ${s.lname}`.toLowerCase().includes(a.toLowerCase())||s.id.toString().includes(a)):n,[n,a]),L=()=>{!c||i.length===0||_.post(route("cell-assignments.store"),{cell_id:c,pdl_ids:i},{onSuccess:()=>{m(!1),h(""),u([]),g("")}})},w=s=>{u(l=>l.includes(s)?l.filter(x=>x!==s):[...l,s])},P=()=>{const s=t.map(l=>l.id);u(l=>s.every(x=>l.includes(x))?l.filter(x=>!s.includes(x)):[...new Set([...l,...s])])},{props:f}=N(),C=f.success,b=f.errors||{};return e.jsxs(F,{open:p,onOpenChange:m,children:[e.jsx($,{asChild:!0,children:e.jsx(d,{children:"Assign PDL to Cell"})}),e.jsxs(O,{className:"max-h-[80vh] max-w-3xl overflow-y-auto",children:[e.jsxs(z,{children:[e.jsx(B,{children:"Assign PDLs to Cell"}),e.jsx(H,{children:"Select a cell and choose PDLs to assign to it."})]}),Object.keys(b).length>0&&e.jsx("div",{"data-alert-container":!0,className:"relative",children:e.jsxs(y,{variant:"destructive",children:[e.jsx("button",{type:"button","aria-label":"Close",onClick:s=>{const l=s.currentTarget.closest("[data-alert-container]")||void 0;l&&(l.style.display="none")},className:"absolute top-2 right-2 rounded p-1 text-lg leading-none hover:bg-muted",children:"Ã—"}),e.jsx(v,{children:"Unable to process request"}),e.jsx(S,{children:e.jsx("ul",{className:"list-inside list-disc space-y-1",children:Object.values(b).map((s,l)=>e.jsx("li",{className:"text-sm",children:s},l))})})]})}),C&&e.jsx("div",{"data-alert-container":!0,className:"relative",ref:s=>{if(!s)return;s.style.display="";const l=s;l._timer&&clearTimeout(l._timer),l._timer=setTimeout(()=>{s.style.display="none"},3e3)},children:e.jsxs(y,{children:[e.jsx("button",{type:"button","aria-label":"Close",onClick:s=>{const l=s.currentTarget.closest("[data-alert-container]")||void 0;l&&(l.style.display="none")},className:"absolute top-2 right-2 rounded p-1 text-sm leading-none hover:bg-muted",children:"Ã—"}),e.jsx(v,{children:"Success"}),e.jsx(S,{children:C})]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{htmlFor:"cell",children:"Select Cell"}),e.jsxs(W,{value:c,onValueChange:h,children:[e.jsx(X,{children:e.jsx(Y,{placeholder:"Choose a cell"})}),e.jsx(Z,{children:r.map(s=>e.jsxs(ee,{value:s.cell_id.toString(),children:[s.cell_name," (Capacity: ",s.capacity,")"]},s.cell_id))})]})]}),c&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(j,{htmlFor:"pdl-search",children:"Select PDLs"}),e.jsx(d,{variant:"outline",size:"sm",onClick:P,disabled:t.length===0,children:"Toggle All Filtered"})]}),e.jsx(A,{id:"pdl-search",placeholder:"Search PDLs by name or ID",value:a,onChange:s=>g(s.target.value)}),e.jsx("div",{className:"max-h-60 overflow-y-auto rounded-md border p-2",children:t.length>0?t.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-gray-50",children:[e.jsx(Q,{id:`pdl-${s.id}`,checked:i.includes(s.id),onCheckedChange:()=>w(s.id)}),e.jsxs("label",{htmlFor:`pdl-${s.id}`,className:"text-sm leading-none font-medium peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:[s.fname," ",s.lname," (ID: ",s.id,")"]})]},s.id)):e.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:a?"No PDLs match your search":"No PDLs available"})}),i.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Selected: ",i.length," PDL(s)"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(d,{onClick:L,disabled:!c||i.length===0,children:"Assign Selected"})]})]})]})}function De(){const{props:r}=N(),{assignments:n,cells:p,pdls:m,filters:c}=r,[h,i]=o.useState(c.search||""),u=n.map(t=>({assignment_id:t.assignment_id,cell_number:t.cell.cell_name,cell_id:t.cell.cell_id,pdl_id:t.pdl.id,pdl_name:`${t.pdl.fname} ${t.pdl.lname}`,assigned_date:t.created_at})),a=()=>{_.get("/admin/pdl-management/cell-assignment",{search:h})},g=[{title:"Cell Management",href:"/cell-management"},{title:"Assignments",href:"/admin/pdl-management/cell-assignment"}];return e.jsxs(V,{breadcrumbs:g,children:[e.jsx(T,{title:"Cell Assignment Management"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Cell Assignments"}),e.jsxs(I,{children:[e.jsx(M,{children:e.jsx(E,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Cell Assignment List"}),e.jsx(le,{cells:p,pdls:m})]})})}),e.jsxs(K,{children:[e.jsxs("div",{className:"mb-4 flex items-center space-x-4",children:[e.jsx(j,{htmlFor:"search",className:"text-sm font-medium",children:"Search Assignments"}),e.jsx(A,{id:"search",placeholder:"Search by cell number or PDL name",className:"w-64",value:h,onChange:t=>i(t.target.value),onKeyDown:t=>t.key==="Enter"&&a()}),e.jsx(d,{variant:"outline",onClick:a,children:"Search"})]}),e.jsx(k,{columns:se,data:u})]})]})]})]})}export{De as default};
