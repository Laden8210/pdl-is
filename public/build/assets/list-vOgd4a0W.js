import{K as L,r as T,m as K,j as e,L as U}from"./app-B_O9F4tw.js";import{C as ne,a as te,b as de,c as ie}from"./card-DH5vEpEW.js";import{T as Y,a as J,b as _,c as n,d as Q,e as t}from"./table-D4KjtlNv.js";import{A as k,b as B,a as G}from"./alert-rMAx_BHs.js";import{B as i}from"./button-BiD3r4ZK.js";import{D as A,i as W,a as D,b as C,c as S,d as M,g as R,h as X,A as ce}from"./app-layout-Be9EpAUR.js";import{L as y}from"./label-CZmbwHrp.js";import{S as F,a as I,b as O,c as q,d as o}from"./select-BA3BSQrm.js";import{T as Z}from"./textarea-dmpnxrHE.js";import{I as oe}from"./input-Cch6FJY3.js";import{B as H}from"./badge-D51X8G92.js";import{E as me}from"./eye-CcSNQFx3.js";import{C as z}from"./scale-D2Wxh09W.js";import{U as xe}from"./user-Dmxs8yN8.js";import{S as he}from"./square-pen-CElkQu1N.js";import{T as je}from"./trash-2-CwswV8QO.js";import{T as ue}from"./triangle-alert-MbqshiFX.js";import{f as v}from"./format-B3rlCQGj.js";import{C as ge}from"./custody-management-DrTXIXdV.js";import{g as ye}from"./dateUtils-Iw3XMDmk.js";import"./index-D5DTq6I9.js";import"./users-DIrrmxra.js";import"./index-D-eL34-K.js";import"./index-ByUPiVeH.js";import"./index-B3ch-uBW.js";import"./index-BCyguBGw.js";function pe({pdl:s,records:m}){const{props:r}=L(),x=r.success,[w,j]=T.useState(null),[p,c]=T.useState(!1),[d,f]=T.useState(null),[N,h]=T.useState(!1),{data:b,setData:u,put:E,delete:l,processing:g,errors:V,reset:P}=K({type:"gcta",days:0,reason:""}),ee=a=>{j(a),u({type:a.type,days:a.days,reason:a.reason}),c(!0)},se=a=>{a.preventDefault(),w&&E(route("admin.time-allowance.update-record",w.id),{preserveScroll:!0,onSuccess:()=>{P(),c(!1),j(null)}})},ae=a=>{f(a),h(!0)},re=()=>{d&&l(route("admin.time-allowance.revoke",d.id),{preserveScroll:!0,onSuccess:()=>{h(!1),f(null)}})},$=a=>a==="gcta"?e.jsx(H,{className:"bg-blue-100 text-blue-800",children:"GCTA"}):e.jsx(H,{className:"bg-green-100 text-green-800",children:"TASTM"});return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(U,{title:"Time Allowance Records"}),e.jsx(W,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"View Records"]})}),e.jsxs(D,{className:"sm:max-w-[800px] max-h-[80vh] overflow-y-auto",children:[e.jsxs(C,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Time Allowance Records for ",s.fname," ",s.lname]}),e.jsx(M,{children:"View and manage all time allowance records for this PDL."})]}),x&&e.jsxs(k,{variant:"default",className:"mb-4 border-green-200 bg-green-50 text-green-800",children:[e.jsx(B,{children:"Success"}),e.jsx(G,{children:x})]}),m.length>0?e.jsx("div",{className:"space-y-4",children:e.jsxs(Y,{children:[e.jsx(J,{children:e.jsxs(_,{children:[e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Days"}),e.jsx(n,{children:"Reason"}),e.jsx(n,{children:"Awarded By"}),e.jsx(n,{children:"Date"}),e.jsx(n,{className:"text-right",children:"Actions"})]})}),e.jsx(Q,{children:m.map(a=>e.jsxs(_,{children:[e.jsx(t,{children:$(a.type)}),e.jsxs(t,{className:"font-medium",children:[a.days," days"]}),e.jsx(t,{className:"max-w-xs truncate",children:a.reason}),e.jsx(t,{children:a.awardedBy?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm",children:[a.awardedBy.fname," ",a.awardedBy.lname]})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Unknown"})}),e.jsx(t,{children:v(new Date(a.awarded_at),"MMM dd, yyyy")}),e.jsx(t,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>ee(a),className:"h-8 w-8 p-0",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>ae(a),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(je,{className:"h-4 w-4"})})]})})]},a.id))})]})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(z,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No time allowance records found for this PDL."})]}),e.jsx(R,{children:e.jsx(X,{asChild:!0,children:e.jsx(i,{variant:"secondary",children:"Close"})})})]})]}),e.jsx(A,{open:p,onOpenChange:c,children:e.jsx(D,{className:"sm:max-w-[500px]",children:e.jsxs("form",{id:"edit-time-allowance-form",onSubmit:se,children:[e.jsxs(C,{children:[e.jsx(S,{children:"Edit Time Allowance Record"}),e.jsx(M,{children:"Update the details for this time allowance record."})]}),Object.keys(V).length>0&&e.jsxs(k,{variant:"destructive",className:"mb-4 mt-4",children:[e.jsx(B,{children:"Unable to process request"}),e.jsx(G,{children:Object.values(V).map((a,le)=>e.jsx("ul",{className:"list-inside list-disc text-sm",children:e.jsx("li",{children:String(a)})},le))})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"edit-type",children:"Allowance Type"}),e.jsxs(F,{value:b.type,onValueChange:a=>u("type",a),required:!0,children:[e.jsx(I,{children:e.jsx(O,{placeholder:"Select allowance type"})}),e.jsxs(q,{children:[e.jsx(o,{value:"gcta",children:"Good Conduct Time Allowance (GCTA)"}),e.jsx(o,{value:"tastm",children:"Time Allowance for Study, Teaching & Mentoring (TASTM)"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"edit-days",children:"Days"}),e.jsx(oe,{id:"edit-days",name:"days",type:"number",min:"0",value:b.days,onChange:a=>u("days",parseInt(a.target.value)||0),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"edit-reason",children:"Reason"}),e.jsx(Z,{id:"edit-reason",name:"reason",value:b.reason,onChange:a=>u("reason",a.target.value),placeholder:"Enter the reason for this time allowance",required:!0})]})]}),e.jsxs(R,{children:[e.jsx(i,{type:"button",variant:"secondary",onClick:()=>{c(!1),j(null),P()},children:"Cancel"}),e.jsx(i,{type:"submit",form:"edit-time-allowance-form",className:"bg-blue-500 hover:bg-blue-600",disabled:g,children:g?"Updating...":"Update Record"})]})]})})}),e.jsx(A,{open:N,onOpenChange:h,children:e.jsxs(D,{className:"sm:max-w-[400px]",children:[e.jsxs(C,{children:[e.jsxs(S,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(ue,{className:"h-5 w-5"}),"Confirm Deletion"]}),e.jsx(M,{children:"Are you sure you want to revoke this time allowance record? This action cannot be undone."})]}),d&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[$(d.type),e.jsxs("span",{className:"font-medium",children:[d.days," days"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:[e.jsx("strong",{children:"Reason:"})," ",d.reason]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Date:"})," ",v(new Date(d.awarded_at),"MMM dd, yyyy")]})]}),e.jsxs(R,{children:[e.jsx(i,{variant:"secondary",onClick:()=>{h(!1),f(null)},children:"Cancel"}),e.jsx(i,{variant:"destructive",onClick:re,disabled:g,children:g?"Revoking...":"Revoke Record"})]})]})})]})}function fe({pdl:s,gctaDays:m,tastmDays:r,records:x}){const{props:w}=L(),j=w.success,p=()=>{const l=typeof(s==null?void 0:s.years_served)=="object"?s.years_served.years:(s==null?void 0:s.years_served)||0;return l>=0&&l<=2?20:l>=3&&l<=5?23:l>=6&&l<=10?25:l>=11?30:20},{data:c,setData:d,post:f,processing:N,errors:h,reset:b}=K({type:"gcta",days:p(),reason:""}),u=l=>{l.preventDefault(),f(route("admin.time-allowance.update",s.id),{preserveScroll:!0,onSuccess:()=>{b()}})},E=l=>{d("type",l),l==="gcta"?d("days",p()):d("days",15)};return e.jsxs(A,{children:[e.jsx(U,{title:"Manage Time Allowance"}),e.jsx(W,{asChild:!0,children:e.jsx(i,{variant:"outline",children:"Manage Allowance"})}),e.jsx(D,{className:"sm:max-w-[500px]",children:e.jsxs("form",{id:"time-allowance-form",onSubmit:u,children:[e.jsxs(C,{children:[e.jsxs(S,{children:["Manage Time Allowance for ",s.fname," ",s.lname]}),e.jsx(M,{children:"Add time allowance days for Good Conduct Time Allowance (GCTA) or Time Allowance for Study, Teaching and Mentoring (TASTM)."})]}),Object.keys(h).length>0&&e.jsxs(k,{variant:"destructive",className:"mb-4 mt-4",children:[e.jsx(B,{children:"Unable to process request"}),e.jsx(G,{children:Object.values(h).map((l,g)=>e.jsx("ul",{className:"list-inside list-disc text-sm",children:e.jsx("li",{children:l})},g))})]}),j&&e.jsxs(k,{variant:"default",className:"mb-4 border-green-200 bg-green-50 text-green-800",children:[e.jsx(B,{children:"Success"}),e.jsx(G,{children:j})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 py-2",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-md border border-blue-200",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Current GCTA Days"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:m})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-md border border-green-200",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:"Current TASTM Days"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:r})]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-md border border-gray-200 mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"Years Served"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:typeof(s==null?void 0:s.years_served)=="object"?s.years_served.formatted:`${(s==null?void 0:s.years_served)||0} years`}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"GCTA Default:"})," ",p()," days per month (based on ",typeof(s==null?void 0:s.years_served)=="object"?s.years_served.years:(s==null?void 0:s.years_served)||0," years served)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"TASTM Default:"})," 15 days per month (fixed)"]})]})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"type",children:"Allowance Type"}),e.jsxs(F,{value:c.type,onValueChange:E,required:!0,children:[e.jsx(I,{children:e.jsx(O,{placeholder:"Select allowance type"})}),e.jsxs(q,{children:[e.jsx(o,{value:"gcta",children:"Good Conduct Time Allowance (GCTA)"}),e.jsx(o,{value:"tastm",children:"Time Allowance for Study, Teaching & Mentoring (TASTM)"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"days",children:"Days to Add"}),e.jsxs(F,{value:c.days.toString(),onValueChange:l=>d("days",parseInt(l)),required:!0,children:[e.jsx(I,{children:e.jsx(O,{placeholder:"Select days to add"})}),e.jsx(q,{children:c.type==="gcta"?e.jsxs(e.Fragment,{children:[e.jsx(o,{value:"20",children:"20 days (0-2 years served)"}),e.jsx(o,{value:"23",children:"23 days (3-5 years served)"}),e.jsx(o,{value:"25",children:"25 days (6-10 years served)"}),e.jsx(o,{value:"30",children:"30 days (11+ years served)"})]}):e.jsx(o,{value:"15",children:"15 days (TASTM fixed)"})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"reason",children:"Reason"}),e.jsx(Z,{id:"reason",name:"reason",value:c.reason,onChange:l=>d("reason",l.target.value),placeholder:"Enter the reason for adding time allowance",required:!0})]})]}),e.jsx(R,{children:e.jsx("div",{className:"flex items-center justify-between w-full",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(X,{asChild:!0,children:e.jsx(i,{variant:"secondary",children:"Cancel"})}),e.jsx(pe,{pdl:s,records:x}),e.jsx(i,{type:"submit",form:"time-allowance-form",className:"bg-blue-500 hover:bg-blue-600",disabled:N,children:N?"Adding...":"Add Allowance"})]})})})]})})]})}const be=[{title:"PDL Management",href:"/pdl-management"}];function Ke(){const{props:s}=L(),{verifications:m}=s;return console.log("Verifications:",m),e.jsxs(ce,{breadcrumbs:be,children:[e.jsx(U,{title:"Personal Information"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Time Allowance Management"}),e.jsxs(ne,{children:[e.jsx(te,{children:e.jsx(de,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("span",{children:"Time Allowance List"})})})}),e.jsx(ie,{children:e.jsxs(Y,{children:[e.jsx(J,{children:e.jsxs(_,{children:[e.jsx(n,{children:"ID"}),e.jsx(n,{children:"Full Name"}),e.jsx(n,{children:"Alias"}),e.jsx(n,{children:"Gender"}),e.jsx(n,{children:"GCTA Days"}),e.jsx(n,{children:"TASTM Days"}),e.jsx(n,{children:"Admission Date"}),e.jsx(n,{children:"Release Date"}),e.jsx(n,{children:"Date of Birth"}),e.jsx(n,{children:"Age"}),e.jsx(n,{children:"Added By"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(Q,{children:m.map(r=>{var x;return r.pdl&&e.jsxs(_,{children:[e.jsx(t,{children:r.pdl.id}),e.jsx(t,{children:`${r.pdl.fname} ${r.pdl.lname}`}),e.jsx(t,{children:r.pdl.alias??"-"}),e.jsx(t,{children:r.pdl.gender??"-"}),e.jsx(t,{className:"font-medium",children:r.gcta_days}),e.jsx(t,{className:"font-medium",children:r.tastm_days}),e.jsx(t,{children:r.pdl.admission_date?v(new Date(r.pdl.admission_date),"MMM dd, yyyy"):"—"}),e.jsx(t,{children:r.pdl.release_date?v(new Date(r.pdl.release_date),"MMM dd, yyyy"):"—"}),e.jsx(t,{children:v(new Date(r.pdl.birthdate),"MMMM dd, yyyy")}),e.jsx(t,{children:ye(r.pdl.birthdate)}),e.jsx(t,{children:r.pdl.personnel?`${r.pdl.personnel.fname} ${r.pdl.personnel.lname}`:"—"}),e.jsxs(t,{className:"space-x-1 flex items-center gap-2",children:[e.jsx(fe,{pdl:r.pdl,gctaDays:r.gcta_days,tastmDays:r.tastm_days,records:((x=r.pdl)==null?void 0:x.time_allowance_records)||[]}),e.jsx(ge,{pdl:r.pdl})]})]},r.pdl.id)})})]})})]})]})]})}export{Ke as default};
